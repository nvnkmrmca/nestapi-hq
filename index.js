!function(e){var t={};function r(i){if(t[i])return t[i].exports;var d=t[i]={i:i,l:!1,exports:{}};return e[i].call(d.exports,d,d.exports,r),d.l=!0,d.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var d in e)r.d(i,d,function(t){return e[t]}.bind(null,d));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=15)}([function(e,t){e.exports={secret:"mynestappbynaveenkumard",routePrefix:"/api"}},function(e,t){t.success=((e,t,r="")=>e.send({data:t,message:r})),t.unAuthorized=((e,t)=>error(e,401,t)),t.error=((e,t)=>{error(e,500,t)}),t.vError=((e,t)=>error(e,400,t)),t.cError=((e,t)=>error(e,404,t)),t.nError=((e,t)=>error(e,404,t)),error=((e,t,r)=>e.status(t).send({message:r}))},function(e,t,r){const i=r(13),d=r(0),o=r(1);t.checkToken=((e,t,r)=>{let a=e.headers["x-access-token"]||e.headers.authorization;a&&a.startsWith("Bearer ")&&(a=a.slice(7,a.length)),a?i.verify(a,d.secret,(i,d)=>{i?o.unAuthorized(t,"Token is not valid."):(e.decoded=d,r())}):o.unAuthorized(t,"Authentication token is not supplied.")})},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({number:String,type:String,image:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({fromDate:Date,toDate:Date,place:String,address:String,isReturned:Boolean,returnedAt:Date,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({title:String,description:String,file:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),s=i.Schema({_clientId:d.Types.ObjectId,_blockId:d.Types.ObjectId,number:{type:d.Types.String,unique:!0},address:String,bedRoom:Number,parking:String,description:String,members:[d.Types.ObjectId],vehicles:[o],outings:[a],documents:[n],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Home",s)},function(e,t){e.exports=require("mongoose")},function(e,t){t.clone=(e=>JSON.parse(JSON.stringify(e)))},function(e,t,r){"use strict";const i=r(11);t.getName=(e=>new Promise(function(t,r){i.findById(e,{name:1}).then(e=>{let r="";e&&e.name&&(r=e.name),t(r)}).catch(e=>{r(e)})})),t.getNames=(e=>new Promise(function(t,r){i.find({_id:{$in:e}},{_id:1,name:1}).then(e=>{let r=[];e&&e.length>0&&e.map((e,t)=>{r.push({_id:e._id,name:e.name})}),t(r)}).catch(e=>{r(e)})})),t.getAMMailId=(e=>new Promise(function(t,r){i.find({$and:[{_clientId:e,isActive:!0},{$or:[{role:{$regex:"ADMIN",$options:"i"}},{role:{$regex:"MANAGER",$options:"i"}}]}]},{emailId:1}).then(e=>{let r="";e&&e.length>0&&e.map((e,t)=>{e.emailId&&e.emailId.length>0&&(r+=(r.length>0?",":"")+e.emailId)}),t(r)}).catch(e=>{r(e)})})),t.getMailANDFCM=(e=>new Promise(function(t,r){i.findById(e,{_id:1,emailId:1,fcmToken:1}).then(e=>{let r="",i="";e&&e._id&&(r=e.emailId,i=e.fcmToken),t({mailId:r,fcmToken:i})}).catch(e=>{r(e)})})),t.getMailANDFCMs=(e=>new Promise(function(t,r){i.find({_id:{$in:e},isActive:!0},{emailId:1,fcmToken:1}).then(e=>{let r="",i=[];e&&e.length>0&&e.map((e,t)=>{e.emailId&&e.emailId.length>0&&(r+=(r.length>0?",":"")+e.emailId),e.fcmToken&&e.fcmToken.length>0&&i.push(e.fcmToken)}),t({mailIds:r,fcmTokens:i})}).catch(e=>{r(e)})})),t.getAMMailANDFCM=(e=>new Promise(function(t,r){i.find({$and:[{_clientId:e,isActive:!0},{$or:[{role:{$regex:"ADMIN",$options:"i"}},{role:{$regex:"MANAGER",$options:"i"}}]}]},{emailId:1,fcmToken:1}).then(e=>{let r="",i=[];e&&e.length>0&&e.map((e,t)=>{e.emailId&&e.emailId.length>0&&(r+=(r.length>0?",":"")+e.emailId),e.fcmToken&&e.fcmToken.length>0&&i.push(e.fcmToken)}),t({mailIds:r,fcmTokens:i})}).catch(e=>{r(e)})})),t.getAllFCM=(e=>new Promise(function(t,r){i.find({_clientId:e,isActive:!0},{fcmToken:1}).then(e=>{let r=[];e&&e.length>0&&e.map((e,t)=>{e.fcmToken&&e.fcmToken.length>0&&r.push(e.fcmToken)}),t(r)}).catch(e=>{r(e)})})),t.getAMGMailANDFCM=(e=>new Promise(function(t,r){i.find({$and:[{_clientId:e,isActive:!0},{$or:[{role:{$regex:"ADMIN",$options:"i"}},{role:{$regex:"MANAGER",$options:"i"}},{role:{$regex:"GATEKEEPER",$options:"i"}}]}]},{emailId:1,fcmToken:1}).then(e=>{let r="",i=[];e&&e.length>0&&e.map((e,t)=>{e.emailId&&e.emailId.length>0&&(r+=(r.length>0?",":"")+e.emailId),e.fcmToken&&e.fcmToken.length>0&&i.push(e.fcmToken)}),t({mailIds:r,fcmTokens:i})}).catch(e=>{r(e)})}))},function(e,t,r){const i=r(36),d=r(37),o=r(12);t.send=((e,t,r)=>{if(d.isSend&&r&&r.length>0){let a={registration_ids:r,notification:{title:e,body:t},data:{title:e,body:t}};new i(d.serverKey).send(a,function(e,t){e&&o.error("error","fcm.js","fcm.send","Something has gone wrong in FCM.",e)})}})},function(e,t,r){const i=r(34),d=r(35),o=r(12);t.send=((e,t,r,a)=>{try{if(d.isSend){(!r||r.length<1)&&(r=d.to);let n=i.createTransport({host:d.host,port:d.port,secure:d.isSecure,auth:{user:d.userName,pass:d.password}}),s={from:d.from,to:r,subject:e,text:a?"":t,html:a?t:""};n.sendMail(s,(e,t)=>(n.close(),!e||(o.error("error","mail.js","transporter.sendMail","Email not sent.",e),!1)))}}catch(e){return o.error("error","mail.js","exports.send","Email not sent.",e),!1}})},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({name:{type:d.Types.String,unique:!0},description:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({title:String,description:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({title:String,body:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),s=i.Schema({code:{type:d.Types.String,unique:!0},name:String,description:String,address:String,upi:{id:String,name:String},rep:{name:String,mobileNo:String,emailId:String,repType:String},config:{appType:String,hasOtherGender:Boolean,hasPayment:Boolean,ticketCategories:[String],notificationTypes:[String],memberRelationships:[String]},blocks:[o],ads:[a],notifications:[n],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Client",s)},function(e,t,r){"use strict";const i=r(3);t.getNumber=(e=>new Promise(function(t,r){i.findById(e,{number:1}).then(e=>{let r="";e&&e.number&&(r=e.number),t(r)}).catch(e=>{r(e)})})),t.getNumbers=(e=>new Promise(function(t,r){i.find({_id:{$in:e}},{_id:1,number:1}).then(e=>{let r=[];e&&e.length>0&&e.map((e,t)=>{r.push({_id:e._id,number:e.number})}),t(r)}).catch(e=>{r(e)})}))},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({_clientId:{type:d.Types.ObjectId,default:null},number:String,name:String,age:Number,gender:String,mobileNo:String,emailId:String,password:String,type:String,role:String,image:String,relationship:String,otherRelationship:String,isPrimary:Boolean,hasOwnAccess:Boolean,isOwnAccessRequested:Boolean,fcmToken:String,os:String,osVersion:String,isApproved:{type:d.Types.Boolean,default:null},isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Member",o)},function(e,t,r){const i=r(20),d=r(21),o=r(22),a=r(23),n=r(24),s=r(25),c=s.logFileDirName;s.isActive&&!i.existsSync(c)&&i.mkdirSync(c);const l=s.file;l.filename=l.filename?`${c}/%DATE%-${l.filename}.log`:`${c}/%DATE%.log`;const m=Symbol.for("message"),h=e=>{const t={timestamp:o().format("MMMM Do YYYY, h:mm:ss A; ")},r=Object.assign(t,e);return e[m]=JSON.stringify(r),e};
/*!
 * Export logger as singleton.
 */
e.exports=new class{constructor(){s.isActive&&(this.winston=a.createLogger({format:a.format(h)(),transports:[new a.transports.Console(s.console),new n(l)],exitOnError:!1}))}log(e,t,r){s.isActive?r?this.winston.log(e,t,r):this.winston.log(e,t):console.log(e+": ",t,r||"")}error(e,t,r,i,o){"object"==typeof i&&(i=d.inspect(i)),this.log(e,{filename:t,modulename:r,message:i},o)}warn(e,t){this.log("warn",e,t)}info(e,t){this.log("info",e,t)}verbose(e,t){this.log("verbose",e,t)}debug(e,t){this.log("debug",e,t)}silly(e,t){this.log("silly",e,t)}}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("shortid")},function(e,t,r){const i=r(16),d=r(17);var o=r(18);const a=r(4),n=r(19),s=r(12);var c=i(),l=process.env.PORT||3001;c.use(d.urlencoded({extended:!0})),c.use(d.json()),c.use(o({credentials:!0,origin:!0})),a.Promise=global.Promise,a.connect(n.url,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(()=>{s.info("Successfully connected to the database.")}).catch(e=>{s.error("error","index.js","mongoose.connect","Could not connect to the database. Exiting now...",e),process.exit()}),c.use(i.static("assets")),c.use(i.static("web")),c.get("/",(e,t)=>{var r=url.parse(e.url,!0);let i="/index.html";r.pathname&&r.pathname.length>0&&"/#"!=r.pathname.substring(0,2)&&(i=r.pathname),t.sendFile("./web"+i,{root:"./"})}),r(26)(c),c.listen(l,()=>{s.info("API Server is listening on port "+l)})},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports={url:"mongodb+srv://naveen:nvnkmr%40123@cluster0-r86wa.mongodb.net/nest?retryWrites=true&w=majority"}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t){e.exports={isActive:!1,logFileDirName:"logs",console:{level:"degug",colorize:!0,handleExceptions:!0,json:!1},file:{timestamp:!0,json:!1,datePattern:"YYYY-MM-DD",filename:"nest",maxfiles:"14d",maxsize:1e7,level:"info",zippedArchive:!1}}},function(e,t,r){"use strict";e.exports=(e=>{r(27)(e),r(29)(e),r(31)(e),r(38)(e),r(40)(e),r(42)(e),r(45)(e),r(48)(e),r(51)(e),r(53)(e),r(55)(e),r(57)(e),r(59)(e),r(62)(e),r(65)(e),r(67)(e),r(69)(e)})},function(e,t,r){"use strict";const i=r(28),d=r(0).routePrefix+"/heartbeat";e.exports=(e=>{e.route(d).get(i.get)})},function(e,t,r){"use strict";const i=r(1);t.get=((e,t)=>i.success(t,null,"API is alive."))},function(e,t,r){"use strict";const i=r(2),d=r(30),o=r(0).routePrefix+"/client";e.exports=(e=>{e.post(o,i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(9),d=r(3),o=r(11),a=r(1);t.create=((e,t)=>{if(!(e.body.code&&e.body.name&&e.body.repName&&e.body.repMobileNo&&e.body.repType&&e.body.adminName&&e.body.adminAge&&e.body.adminGender&&e.body.adminMobileNo&&e.body.adminEmailId&&e.body.adminPassword&&e.body.appType))return a.vError(t,"Please fill all the required fields.");let r=e.headers["user-id"]||"";new i({code:e.body.code,name:e.body.name,description:e.body.description||"",address:e.body.address||"",upi:{id:e.body.upiId||"",name:e.body.upiName||""},rep:{name:e.body.repName||"",mobileNo:e.body.repMobileNo||"",emailId:e.body.repEmailId||"",repType:e.body.repType||""},config:{appType:e.body.appType||"",hasOtherGender:e.body.hasOtherGender||!1,hasPayment:e.body.hasPayment||!1,ticketCategories:e.body.ticketCategories||[],notificationTypes:e.body.notificationTypes||[],memberRelationships:e.body.memberRelationships||[]},blocks:[{name:"COMMITTEE",description:"Block for committee members.",isActive:!0}],ads:[],polls:[],notifications:[],isActive:!0,createdBy:r||null}).save().then(i=>{if(!i||!i.blocks||i.blocks.length<1)return a.cError(t,"Failed to load client.");new o({_clientId:i._id,number:"CM1",name:e.body.adminName||"",age:e.body.adminAge||0,gender:e.body.adminGender||"",mobileNo:e.body.adminMobileNo||"",emailId:e.body.adminEmailId||"",password:e.body.adminPassword||"",type:"ADMIN",role:"ADMIN,MANAGER,GATEKEEPER,USER,MAINTENANCE SUPERVISOR,SECURITY SUPERVISOR,MAINTENANCE MANAGER,SECURITY MANAGER",image:"",fcmToken:"",os:"",osVersion:"",isApproved:!0,isPrimary:!0,hasOwnAccess:!0,isOwnAccessRequested:!1,isActive:!0,createdBy:r||null}).save().then(e=>{if(!e||!e._id)return a.cError(t,"Failed to load member.");new d({_clientId:i._id,_blockId:i.blocks[0]._id,number:"COMMITTEE1",address:"COMMITTEE",bedRoom:0,parking:"",description:"",members:[e._id],vehicles:[],outings:[],documents:[],isActive:!0,createdBy:r||null}).save().then(e=>e&&e._id?a.success(t,i._id):a.cError(t,"Failed to load home.")).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{i.find().then(e=>a.success(t,e)).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findById(e.params.id).then(r=>r?a.success(t,r):a.cError(t,"Record not found with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Error retrieving record with id "+e.params.id))}),t.update=((e,t)=>{if(!(e.body.name&&e.body.repName&&e.body.repMobileNo&&e.body.repType))return a.vError(t,"Please fill all the required fields.");let r=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{code:e.body.code,name:e.body.name,description:e.body.description||"",address:e.body.address||"",upi:{id:e.body.upiId||"",name:e.body.upiName||""},rep:{name:e.body.repName||"",mobileNo:e.body.repMobileNo||"",emailId:e.body.repEmailId||"",repType:e.body.repType||""},updatedBy:r},{new:!0}).then(r=>r?a.success(t,r._id):a.cError(t,"Record not found with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{let r=e.headers["user-id"]||"";o.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:r||null}).then(r=>r?a.success(t,!0,"Record deleted successfully."):a.cError(t,"Record not found with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Could not delete record with id "+e.params.id))}),t.search=((e,t)=>{i.find({name:new RegExp(e.params.text,"i")}).then(e=>a.success(t,e)).catch(e=>a.error(t,e.message||"Some error occurred while retrieving records."))})},function(e,t,r){"use strict";const i=r(2),d=r(32),o=r(0).routePrefix+"/account";e.exports=(e=>{e.post(o+"/login",d.login),e.get(o+"/profile",i.checkToken,d.profile),e.post(o+"/changepassword/:id",i.checkToken,d.changePassword),e.post(o+"/resetpassword",d.resetPassword),e.put(o+"/profile/:id",i.checkToken,d.updateProfile),e.post(o+"/signup",d.signUp),e.get(o+"/wfausers",i.checkToken,d.wfaUsers),e.delete(o+"/rejectuser/:id",i.checkToken,d.rejectUser)})},function(e,t,r){"use strict";const i=r(4),d=r(13);var o=r(14);const a=r(0),n=r(9),s=r(3),c=r(11),l=r(33),m=r(5),h=r(1),u=r(8),p=r(7);t.login=((e,t)=>{if(!e.body.userName||!e.body.password)return h.vError(t,"Validation failed. Please fill all the required fields.");c.find({$and:[{mobileNo:e.body.userName,password:e.body.password,isActive:!0,isApproved:!0,hasOwnAccess:!0}]},{_id:1,_clientId:1,number:1,name:1}).then(r=>{if(!r||r.length<1)return h.cError(t,"User not found.");(e.body.fcmToken||e.body.os||e.body.osVersion)&&c.findByIdAndUpdate(r[0]._id,{fcmToken:e.body.fcmToken||"",os:e.body.os||"",osVersion:e.body.osVersion||""},{new:!0}).then(e=>{}).catch(e=>{});let i=d.sign({username:e.body.userName},a.secret,{expiresIn:"24h"});return h.success(t,{token:i,userId:r[0]._id,clientId:r[0]._clientId})}).catch(e=>"ObjectId"===e.kind?h.nError(t,"User not found."):h.error(t,"Internal Server Error."))}),t.profile=((e,t)=>{let r=e.headers["user-id"]||"",i=e.headers["client-id"]||"";if(!r||r.length<1||!i||i.length<1)return h.vError(t,"Validation failed. Please send user id and client id.");c.find({$and:[{_id:r,isActive:!0}]},{number:1,name:1,age:1,gender:1,mobileNo:1,emailId:1,type:1,role:1,image:1,relationship:1,otherRelationship:1,isApproved:1,isPrimary:1,hasOwnAccess:1,isOwnAccessRequested:1,createdBy:1}).then(e=>{if(!e||e.length<1)return h.cError(t,"User not found.");(e=m.clone(e[0])).createdBy&&c.findOne({_id:e.createdBy},{name:1}).then(t=>{t&&t.name&&(e.createdBy=t.name)}).catch(t=>{e.createdBy=""}),s.find({$and:[{members:{$all:[e._id]},isActive:!0}]},{_blockId:.1,number:.1,address:.1,bedRoom:.1,parking:1,description:.1,members:1,vehicles:[{$elemMatch:{isActive:!0}}]}).then(r=>{let d=r.map(e=>e._blockId);e.homes=m.clone(r),n.find({$and:[{_id:i,isActive:!0}]},{name:1,description:1,address:1,upi:1,rep:1,config:1,blocks:{$elemMatch:{_id:{$in:d},isActive:!0}}}).then(r=>{if(!r||r.length<1)return h.success(t,e);r=r[0],e.homes.forEach(e=>{e.block=r.blocks.find(t=>t._id==e._blockId)}),delete(r=m.clone(r)).blocks,e.client=r;let i=[],d=[];e.homes.map((e,t)=>{i=i.concat(e.members),d.push(e._id)}),c.find({$and:[{_id:{$in:i},isActive:!0}]},{number:1,name:1,age:1,gender:1,mobileNo:1,emailId:1,type:1,role:1,image:1,relationship:1,otherRelationship:1,isApproved:1,isPrimary:1,hasOwnAccess:1,isOwnAccessRequested:1}).then(r=>{r&&r.length>0&&(r=m.clone(r),e.homes.forEach(e=>{e.payments=[],e.memberIds=e.members,e.members=r.filter((e,t)=>i.includes(e._id))})),l.find({$and:[{_homeId:{$in:d},isActive:!0}]},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(r=>(r&&r.length>0&&(r=m.clone(r),e.homes.forEach(e=>{e.payments=r.filter((t,r)=>t._homeId==e._id),e.payments&&e.payments.length>0&&(e.payments=e.payments.reverse(),e.payments.forEach(e=>{e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse())}))})),h.success(t,e))).catch(r=>h.success(t,e))}).catch(r=>h.success(t,e))}).catch(r=>h.success(t,e))}).catch(r=>h.success(t,e))}).catch(e=>"ObjectId"===e.kind?h.nError(t,"User not found."):h.error(t,"Internal Server Error."))}),t.changePassword=((e,t)=>{if(!e.params.id||!e.body.password||!e.body.newPassword)return h.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";c.findOneAndUpdate({_id:e.params.id,password:e.body.password},{password:e.body.newPassword||"",updatedBy:r},{new:!0}).then(e=>e&&e._id?h.success(t,!0):h.success(t,!1,"Please enter the valid password.")).catch(r=>"ObjectId"===r.kind?h.nError(t,"Record not found with id "+e.params.id):h.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.resetPassword=((e,t)=>{if(!e.body.mobileNo||!e.body.emailId)return h.vError(t,"Validation failed. Please fill all the required fields.");c.findOne({mobileNo:e.body.mobileNo,emailId:e.body.emailId,isActive:!0},{_id:1}).then(r=>{if(r&&r._id){let i=o.generate();c.findByIdAndUpdate(r._id,{password:i}).then(r=>{if(!r||!r._id)return h.cError(t,"User not found.");let d="<html><body>";return d+='<div style="width: 100%; margin: 15px;">',d+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">Nest Password Reset</div>',d+='<div style="width: 100%;">',d+='<div style="width: 100%; margin: 5px 0px;">Your new password: '+i+"</div>",d+='<div style="width: 100%; margin: 5px 0px;">Change your password after login.</div>',d+="</div>",d+="</body></html>",u.send("Nest Password Reset",d,e.body.emailId,!0),h.success(t,{data:!0,message:""})}).catch(e=>h.error(t,e.message||"Some error occurred while updating data."))}else c.findOne({mobileNo:e.body.mobileNo,isActive:!0},{_id:1,emailId:1}).then(r=>{if(r&&r._id&&r.emailId&&!(r.emailId.length<1)){let e=r.emailId.split("@");if(e&&e.length>1){let r=e[0].length>3?e[0].substr(e[0].length-3,3):e[0];return h.success(t,{data:!1,message:"Email Id entered not matches. Email Id ends with "+r+" is associated with the Mobile Number you entered. So you can use that Email Id."})}return h.success(t,{data:!1,message:"No valid Email Id available for the Mobile Number you entered. So please contact administartor to update your email Id."})}c.findOne({emailId:e.body.emailId,isActive:!0},{_id:1,mobileNo:1}).then(e=>{if(!e||!e._id||!e.mobileNo||e.mobileNo.length<1)return h.success(t,{data:!1,message:"Mobile Number & Email Id entered not matches. Please enter the registered Mobile Number and Email Id. If you not have an account, Please create a new account."});if(e.mobileNo&&e.mobileNo.length>0){let r=e.mobileNo.length>3?e.mobileNo.substr(e.mobileNo.length-3,3):e.mobileNo;return h.success(t,{data:!1,message:"Mobile Number entered not matches. Mobile Number ends with "+r+" is associated with the Email Id you entered. So you can use that Mobile Number."})}return h.success(t,{data:!1,message:"No valid Mobile Number available for the Email Id you entered. So please contact administartor to update your Mobile Number."})}).catch(e=>h.error(t,e.message||"Some error occurred while retrieving data."))}).catch(e=>h.error(t,e.message||"Some error occurred while retrieving data."))}).catch(e=>h.error(t,e.message||"Some error occurred while retrieving data."))}),t.updateProfile=((e,t)=>{if(!e.body.name||!e.body.mobileNo||!e.body.emailId)return h.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";c.findOne({mobileNo:e.body.mobileNo,isActive:!0},{_id:1}).then(i=>{if(e.body.mobileNo&&i&&i._id&&i._id!=e.params.id)return h.cError(t,"User with same mobile number already exists. So please try with different mobile number.");c.findByIdAndUpdate(e.params.id,{name:e.body.name||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",image:e.body.image||"",updatedBy:r},{new:!0}).then(r=>r&&r._id?h.success(t,!0):h.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?h.nError(t,"Record not found with id "+e.params.id):h.error(t,"Internal server error. Error updating record with id "+e.params.id))}).catch(r=>h.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.signUp=((e,t)=>{if(!(e.body.clientCode&&e.body.name&&e.body.age&&e.body.gender&&e.body.mobileNo&&e.body.emailId))return h.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";c.findOne({$and:[{$or:[{mobileNo:e.body.mobileNo}],isActive:!0}]},{_id:1}).then(d=>{if(d&&d._id)return h.cError(t,"User with same mobile number already exists. So please try with different mobile number.");n.findOne({code:e.body.clientCode,isActive:!0},{_id:1}).then(d=>{if(!d||!d._id)return h.cError(t,"Invalid App Code. Please contact administrator/manager to get a valid one.");new c({_clientId:d._id,number:e.body.number||"",name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",password:e.body.password||e.body.mobileNo,type:e.body.type||"",role:e.body.role||"",image:e.body.image||"",fcmToken:e.body.fcmToken||"",os:e.body.os||"",osVersion:e.body.osVersion||"",isPrimary:!0,hasOwnAccess:!0,isActive:!1,createdBy:i.Schema.Types.ObjectId(r)}).save().then(e=>e&&e._id?h.success(t,e._id):h.cError(t,"Data not found. Some problem occurs.")).catch(e=>h.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>h.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>h.error(t,e.message||"Some error occurred while creating a record."))}),t.wfaUsers=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return h.vError(t,"Validation failed. Please send client id.");c.find({_clientId:r,isApproved:null}).then(e=>h.success(t,e)).catch(e=>h.error(t,e.message||"Some error occurred while retrieving data."))}),t.rejectUser=((e,t)=>{let r=e.headers["user-id"]||"";c.findByIdAndUpdate(e.params.id,{isActive:!1,isApproved:!1,updatedBy:r||null}).then(r=>r&&r._id?(y(r.name,r.emailId,r.fcmToken),h.success(t,!0,"Rejected successfully.")):h.cError(t,"Could not update record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?h.nError(t,"Record not found with id "+e.params.id):h.error(t,"Internal server error. Could not delete record with id "+e.params.id))});const y=(e,t,r)=>{let i="<html><body>";i+='<div style="width: 100%; margin: 15px;">',i+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">Hi '+e+",</div>",i+='<div style="width: 100%;">Manager rejected you from accessing the nest app. Please contact manager to enrole your account in nest app.</div>',i+="</div></body></html>";u.send("Manager rejected you from accessing the nest app.",i,[t],!0),p.send("Manager rejected you from accessing the nest app.","Manager rejected you from accessing the nest app. Please contact manager to enrole your account in nest app.",[r])}},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({txnRef:String,txnId:String,amount:Number,status:String,isSuccess:Boolean,reason:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,amount:Number,mode:String,type:String,description:String,forMonth:Number,forYear:Number,transactions:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.models&&i.models.Payment?i.models.Payment:i.model("Payment",a)},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports={isSend:!0,host:"smtp.gmail.com",port:465,isSecure:!0,userName:"orgnaveen@gmail.com",password:"MyNest@123",from:"nestadmin@gmail.com",to:"nvnkmrmca@gmail.com",cc:""}},function(e,t){e.exports=require("fcm-node")},function(e,t){e.exports={isSend:!0,url:"https://fcm.googleapis.com/fcm/send",serverKey:"AIzaSyCXk69hIGKXfWtBxruGjFYOEI4Soxj5UhE",senderId:"422026408390"}},function(e,t,r){"use strict";const i=r(2),d=r(39),o=r(0).routePrefix+"/member";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.put(o+"/allow/:id/:isAllow",i.checkToken,d.allowOwnAccess),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(3),d=r(11),o=r(1),a=r(5),n=r(6),s=r(8),c=r(7);t.create=((e,t)=>{if(!e.body.name||!e.body.age||!e.body.gender)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",a=e.headers["user-id"]||"";d.findOne({$and:[{$or:[{mobileNo:e.body.mobileNo}],isActive:!0}]},{_id:1}).then(n=>{if(e.body.mobileNo&&n&&n._id)return o.cError(t,"User with same mobile number already exists. So please try with different mobile number.");{let n={_clientId:r,number:e.body.number||"",name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",password:e.body.password||e.body.mobileNo,type:e.body.type||"",role:e.body.role||"",image:e.body.image||"",relationship:e.body.relationship||"",otherRelationship:e.body.otherRelationship||"",fcmToken:"",os:"",osVersion:"",isApproved:!0,isActive:!0,createdBy:a};e.body.isAM&&(n.isPrimary=!0,n.hasOwnAccess=!0),new d(n).save().then(r=>r&&r._id?(e.body.isAM?e.body.homeIds&&e.body.homeIds.length>0&&i.updateMany({_id:{$in:e.body.homeIds}},{$push:{members:r._id}},{safe:!0,multi:!0,new:!0}).then(e=>{}).catch(e=>{}):e.params.id&&i.updateOne({_id:e.params.id},{$push:{members:r._id}},{new:!0}).then(e=>{}).catch(e=>{}),o.success(t,r._id)):o.cError(t,"Data not found. Some problem occurs.")).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return o.vError(t,"Validation failed. Please send client id.");d.find({_clientId:r,isActive:!0},{_id:1,number:1,name:1,mobileNo:1,emailId:1}).then(e=>o.success(t,e)).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findAllByHome=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return o.vError(t,"Validation failed. Please send client id.");i.findById(e.params.id,{_id:1,number:1,members:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.members)return o.success(t,[]);d.find({$and:[{_id:{$in:e.members},isActive:!0}]}).then(e=>{if(!e)return o.success(t,[]);e=a.clone(e);let r=[];if(e.map((e,t)=>{e.createdBy&&r.indexOf(e.createdBy.toString())<0&&r.push(e.createdBy)}),!(r&&r.length>0))return o.success(t,e);n.getNames(r).then(r=>(r&&r.length>0&&e.forEach(e=>{let t=r.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdBy=t[0].name)}),o.success(t,e))).catch(r=>o.success(t,e))}).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{d.findById(e.params.id).then(r=>{if(!r||!r._id)return o.cError(t,"Record not found with id "+e.params.id);i.find({$and:[{members:{$all:[e.params.id]},isActive:!0}]},{_id:1}).then(e=>{let i=[];return e&&e.length>0&&e.map((e,t)=>{i.push(e._id)}),o.success(t,{member:r,homeIds:i})}).catch(e=>o.success(t,{member:r,homeIds:[]}))}).catch(r=>"ObjectId"===r.kind?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Error retrieving record with id "+e.params.id))}),t.update=((e,t)=>{if(!e.body.name||!e.body.age||!e.body.gender)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"",a={number:e.body.number||"",name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",type:e.body.type||"",role:e.body.role||"",image:e.body.image||"",relationship:e.body.relationship||"",otherRelationship:e.body.otherRelationship||"",updatedBy:r};e.body.isApprove&&(a.isActive=!0,a.isApproved=!0),d.findOne({mobileNo:e.body.mobileNo,isActive:!0},{_id:1}).then(r=>{if(e.body.mobileNo&&r&&r._id&&r._id!=e.params.id)return o.cError(t,"User with same mobile number already exists. So please try with different mobile number.");d.findByIdAndUpdate(e.params.id,a,{new:!0}).then(r=>r&&r._id?(e.body.isAM&&(i.updateMany({members:r._id},{$pull:{members:{$in:[r._id]}}},{safe:!0,multi:!0}).then(e=>{}).catch(e=>{}),e.body.homeIds&&e.body.homeIds.length>0&&i.updateMany({_id:{$in:e.body.homeIds}},{$push:{members:r._id}},{safe:!0,multi:!0,new:!0}).then(e=>{}).catch(e=>{})),e.body.isApprove&&l(r.name,r.emailId,r.fcmToken),o.success(t,r._id)):o.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Error updating record with id "+e.params.id))}).catch(r=>o.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:r||null}).then(r=>r&&r._id?(i.updateMany({members:{$in:[r._id]}},{$pull:{members:[r._id]}},{safe:!0,multi:!0,new:!0}).then(e=>{}).catch(e=>{}),o.success(t,!0,"Record deleted successfully.")):o.cError(t,"Could not delete record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.allowOwnAccess=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{hasOwnAccess:e.params.isAllow,updatedBy:r||null}).then(r=>r&&r._id?o.success(t,!0,"Own Access allowed successfully."):o.cError(t,"Could not find record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>{let r=new RegExp(e.params.text,"i");d.find({$and:[{$or:[{number:r},{name:r},{mobileNo:r},{emailId:r}],isActive:!0}]}).then(e=>o.success(t,e)).catch(e=>o.error(t,e.message||"Some error occurred while retrieving records."))});const l=(e,t,r)=>{let i="<html><body>";i+='<div style="width: 100%; margin: 15px;">',i+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">Hi '+e+",</div>",i+='<div style="width: 100%;">Manager approved you to access the nest app. Please login using your mobile number for user name and password. Kindly change your password in setting page on first login.</div>',i+="</div></body></html>";s.send("Manager approved you to access the nest app.",i,[t],!0),c.send("Manager approved you to access the nest app.","Manager approved you to access the nest app. Please login using your mobile number for user name and password. Kindly change your password in setting page on first login.",[r])}},function(e,t,r){"use strict";const i=r(2),d=r(41),o=r(0).routePrefix+"/vehicle";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(3),d=r(1),o=r(5),a=r(6);t.create=((e,t)=>{if(!e.body.number||!e.body.type)return d.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{vehicles:{number:e.body.number||"",type:e.body.type||"",image:e.body.image||"",isActive:!0,createdBy:r}}},{new:!0}).then(r=>{if(!r||!r.ok||r.ok<1)return d.cError(t,"Failed to create record.");i.findById(e.params.id,{vehicles:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.vehicles||e.vehicles.length<1?d.cError(t,"Failed to create record."):d.success(t,e.vehicles[e.vehicles.length-1]._id)).catch(e=>d.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return d.vError(t,"Validation failed. Please send client id.");i.find({_clientId:r,isActive:!0},{number:1,vehicles:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||e.length<1)return d.success(t,[]);let r=[];e.map((e,t)=>{let i=e.vehicles;i&&i.length>0&&((i=o.clone(i)).forEach(t=>{t._homeId=e.number}),r=r.concat(i))});let i=[];if((r=r.reverse()).map((e,t)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(t,r);a.getNames(i).then(e=>(e&&e.length>0&&r.forEach(t=>{let r=e.filter(e=>e._id.toString()==t.createdBy);r&&r.length>0&&r[0]._id&&(t.createdBy=r[0].name)}),d.success(t,r))).catch(e=>d.success(t,r))}).catch(e=>d.error(t,e.message||"Some error occurred while retrieving data."))}),t.findAllByHome=((e,t)=>{i.findById(e.params.id,{number:1,vehicles:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.vehicles)return d.success(t,[]);let r=o.clone(e.vehicles);r.forEach(t=>{t._homeId=e.number});let i=[];if((r=r.reverse()).map((e,t)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(t,r);a.getNames(i).then(e=>(e&&e.length>0&&r.forEach(t=>{let r=e.filter(e=>e._id.toString()==t.createdBy);r&&r.length>0&&r[0]._id&&(t.createdBy=r[0].name)}),d.success(t,r))).catch(e=>d.success(t,r))}).catch(e=>d.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findOne({"vehicles._id":e.params.id},{vehicles:[{$elemMatch:{isActive:!0}}]}).then(r=>r&&r.vehicles?(r=r.vehicles.filter((t,r)=>t._id==e.params.id),d.success(t,r&&r.length>0?r[0]:null)):d.cError(t,"Record not found.")).catch(e=>d.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>{if(!e.body.number||!e.body.type)return d.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.findOneAndUpdate({"vehicles._id":e.params.id},{$set:{"vehicles.$.number":e.body.number||"","vehicles.$.type":e.body.type||"","vehicles.$.updatedBy":r||null}},{projection:{_id:1}}).then(r=>r&&r._id?d.success(t,e.params.id):d.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{i.update({"vehicles._id":e.params.id},{$pull:{vehicles:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?d.cError(t,"Could not delete record with id "+e.params.id):d.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>d.cError(t,"Not implemented."))},function(e,t,r){"use strict";const i=r(2),d=r(43),o=r(0).routePrefix+"/servant";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/takeaways/:id",i.checkToken,d.findActiveTakeaways),e.post(o+"/takeaway/:id",i.checkToken,d.addTakeaway),e.put(o+"/takeaway/:id",i.checkToken,d.updateTakeaway),e.delete(o+"/takeaway/:id",i.checkToken,d.deleteTakeaway),e.post(o+"/exittakeaway/:id",i.checkToken,d.exitTakeaway),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(4),d=r(44),o=r(3),a=r(1),n=r(5),s=r(10),c=r(6),l=r(8),m=r(7);t.create=((e,t)=>{if(!e.body.name||!e.body.age||!e.body.gender)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",i=e.headers["user-id"]||"";new d({_clientId:r,_homeId:e.params.id,name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",image:e.body.image||"",takeaways:[],isActive:!0,createdBy:i}).save().then(e=>e&&e._id?a.success(t,e._id):a.cError(t,"Data not found. Some problem occurs.")).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return a.vError(t,"Validation failed. Please send client id.");d.find({_clientId:r,isActive:!0}).sort({_id:-1}).then(e=>{if(!e||e.length<1)return a.success(t,[]);h(e,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findAllByHome=((e,t)=>{d.find({_homeId:e.params.id,isActive:!0}).sort({_id:-1}).then(e=>{if(!e||e.length<1)return a.success(t,[]);h(e,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{d.findById(e.params.id).then(r=>{if(!r||!r._id)return a.cError(t,"Record not found with id "+e.params.id);h([r],t,!0)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>{if(!(e.body.name&&e.body.age&&e.body.gender&&e.params.id))return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",image:e.body.image||"",updatedBy:r},{new:!0}).then(r=>r&&r._id?a.success(t,r._id):a.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:r||null}).then(r=>r&&r._id?a.success(t,!0,"Record deleted successfully."):a.cError(t,"Could not delete record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.findActiveTakeaways=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return a.vError(t,"Validation failed. Please send client id in header.");d.aggregate([{$match:{_clientId:i.Types.ObjectId(r),isActive:!0,"takeaways.isActive":{$eq:!0},"takeaways.isExit":{$eq:!1}}},{$project:{_id:1,_homeId:1,name:1,age:1,gender:1,mobileNo:1,emailId:1,image:1,takeaways:{$filter:{input:"$takeaways",as:"takeaways",cond:{$and:[{$eq:["$$takeaways.isActive",!0]},{$eq:["$$takeaways.isExit",!1]}]}}},createdBy:1,createdAt:1,updatedBy:1,updatedAt:1}}]).then(e=>{if(!e||e.length<1)return a.success(t,[]);h(e,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.addTakeaway=((e,t)=>{if(!e.body.title||!e.body.description||!e.params.id)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";d.updateOne({_id:e.params.id},{$push:{takeaways:{title:e.body.title||"",description:e.body.description,isActive:!0,isExit:!1,createdBy:r||null}}},{new:!0}).then(r=>{if(!r||!r.ok||r.ok<1)return a.cError(t,"Failed to create takeaway.");d.findById(e.params.id,{takeaways:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.takeaways||e.takeaways.length<1?a.cError(t,"Failed to create takeaway."):a.success(t,e.takeaways[e.takeaways.length-1]._id)).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.updateTakeaway=((e,t)=>{if(!e.body.title||!e.body.description||!e.params.id)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";d.findOneAndUpdate({"takeaways._id":e.params.id},{$set:{"takeaways.$.title":e.body.title||"","takeaways.$.description":e.body.description||"","takeaways.$.updatedBy":r||null}},{projection:{_id:1}}).then(r=>r&&r._id?a.success(t,e.params.id):a.cError(t,"Failed to update takewaya.")).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.deleteTakeaway=((e,t)=>{d.update({"takeaways._id":e.params.id},{$pull:{takeaways:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?a.cError(t,"Could not delete record with id "+e.params.id):a.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.exitTakeaway=((e,t)=>{if(!e.body.gateNo||!e.params.id)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";d.findOneAndUpdate({"takeaways._id":e.params.id},{$set:{"takeaways.$.isExit":!0,"takeaways.$.exitBy":r||null,"takeaways.$.exitAt":new Date,"takeaways.$.exitGateNo":e.body.gateNo||"","takeaways.$.updatedBy":r||null}},{projection:{_id:1,_homeId:1,name:1,takeaways:1}}).then(i=>{if(!i||!i._id)return a.cError(t,"Failed to exit takewaya.");let d=i.takeaways.find(t=>t._id.toString()===e.params.id);return d&&d._id&&o.findById(i._homeId,{_id:1,number:1,members:1}).then(t=>{t&&t.members&&u(i.name,d.title,d.description,e.body.gateNo,r,t.members)}).catch(e=>{}),a.success(t,!0,"Takeaway exit successfully.")}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.search=((e,t)=>a.cError(t,"Not implemented."));let h=(e,t,r=!1)=>{e=n.clone(e);let i=[],d=[];e.map((e,t)=>{e._homeId&&i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.createdBy&&d.indexOf(e.createdBy.toString())<0&&d.push(e.createdBy),e.takeaways&&e.takeaways.length>0&&(e.takeaways=e.takeaways.reverse(),e.takeaways.map((e,t)=>{e.createdBy&&d.indexOf(e.createdBy.toString())<0&&d.push(e.createdBy),e.exitBy&&d.indexOf(e.exitBy.toString())<0&&d.push(e.exitBy)}))});let o=[],l=[],m=[];d&&d.length>0&&o.push(c.getNames(d).then(e=>{l=e}).catch(e=>{})),i&&i.length>0&&o.push(s.getNumbers(i).then(e=>{m=e}).catch(e=>{})),Promise.all(o).then(function(){return(l&&l.length>0||m&&m.length>0)&&e.forEach(e=>{if(l&&l.length>0){let t=l.find(t=>t._id.toString()==e.createdBy);t&&t._id&&(e.createdBy=t.name),e.takeaways.forEach(e=>{let r=l.filter(t=>t._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name),(t=e.exitBy&&l.find(t=>t._id.toString()==e.exitBy))&&t._id&&(e.exitBy=t.name)})}let t=m&&m.find(t=>t._id.toString()==e._homeId);return t&&t._id&&(e._homeId=t.number),e}),a.success(t,r&&e&&e.length>0?e[0]:e)}).catch(i=>a.success(t,r&&e&&e.length>0?e[0]:e))};const u=(e,t,r,i,d,o)=>{c.getMailANDFCMs(o).then(o=>{c.getName(d).then(d=>{let a="<html><body>";a+='<div style="width: 100%; margin: 15px;">',a+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+d+" allowed your servent "+e+" to exit with the takeaway "+t+" in the gate "+i+".</div>",a+='<div style="width: 100%;">';let n=d+" allowed your servent "+e+" to exit with the takeaway "+t+" in the gate "+i+".";a+='<div style="width: 100%; margin: 5px 0px;">Takeaway Title: '+t+"</div>",n+="Takeaway Title: "+t,a+='<div style="width: 100%; margin: 5px 0px;">Takeaway Desc: '+r+"</div>",n+="Takeaway Desc: "+r,a+='<div style="width: 100%; margin: 5px 0px;"> Gate: '+i+"</div>",n+="Gate: "+i,a+="</div></body></html>",l.send("Servant "+e+" exit with takeaway in gate "+i,a,o.mailIds,!0),m.send("Servant "+e+" exit with takeaway in gate "+i,n,o.fcmTokens)}).catch(e=>{})}).catch(e=>{})}},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({title:String,description:String,isExit:Boolean,exitGateNo:String,exitBy:{type:d.Types.ObjectId,default:null},exitAt:{type:Date,default:null},isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,name:String,age:Number,gender:String,mobileNo:String,emailId:String,image:String,takeaways:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Servant",a)},function(e,t,r){"use strict";const i=r(2),d=r(46),o=r(0).routePrefix+"/ticket";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.delete(o+"/resolve/:id",i.checkToken,d.resolve),e.put(o+"/start/:id",i.checkToken,d.start),e.post(o+"/comment/:id",i.checkToken,d.addComment),e.put(o+"/comment/:id",i.checkToken,d.updateComment),e.delete(o+"/comment/:id",i.checkToken,d.deleteComment),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(47),d=r(3),o=r(5),a=r(1),n=r(8),s=r(7),c=r(6),l=r(10);t.create=((e,t)=>{if(!(e.body.category&&e.body.title&&e.body.status&&e.params.id))return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"",d=e.headers["client-id"]||"";new i({_clientId:d,_homeId:e.params.id,category:e.body.category,title:e.body.title,description:e.body.description,status:e.body.status,comments:[],isActive:!0,createdBy:r}).save().then(i=>i&&i._id?(h(!0,e.params.id,i.title,i.description,i.status,d,r),a.success(t,i._id)):a.cError(t,"Data not found. Some problem occurs.")).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return a.vError(t,"Validation failed. Please send client id.");d.find({_clientId:r,isActive:!0},{_id:1}).then(e=>{if(!e||e.length<1)return a.success(t,[]);let d=[];e.map((e,t)=>{d.push(e._id)}),i.find({_clientId:r,_homeId:{$in:d},isActive:!0},{_id:1,_homeId:1,category:1,title:1,description:1,status:1,comments:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1}).then(e=>{if(!(e&&e.length>0))return a.success(t,[]);m(e,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findAllByHome=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return a.vError(t,"Validation failed. Please send client id.");i.find({_clientId:r,_homeId:e.params.id,isActive:!0},{_id:1,_homeId:1,category:1,title:1,description:1,status:1,comments:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1}).then(e=>{if(!(e&&e.length>0))return a.success(t,[]);m(e,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findById(e.params.id).then(r=>{if(!r)return a.cError(t,"Record not found with id "+e.params.id);m(r,t,!0)}).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Error retrieving record with id "+e.params.id))}),t.update=((e,t)=>{if(!(e.body.category&&e.body.title&&e.body.status&&e.params.id))return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{category:e.body.category,title:e.body.title,description:e.body.description,status:e.body.status,updatedBy:d},{new:!0}).then(i=>i&&i._id?(h(!1,e.body.homeId,i.title,i.description,i.status,r,d),a.success(t,i._id)):a.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:d||null},{new:!0}).then(i=>i&&i._id?(u(i._homeId,i.title,i.description,i.status,r,d),a.success(t,!0,"Record deleted successfully.")):a.cError(t,"Could not delete record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.resolve=((e,t)=>{let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{status:"RESOLVED",isActive:!1,updatedBy:d||null},{new:!0}).then(i=>i&&i._id?(p(i._homeId,i.title,i.description,i.status,r,d),a.success(t,!0,"Ticket resolved successfully.")):a.cError(t,"Could not resolve the ticket with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.start=((e,t)=>{let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{status:e.body.status,updatedBy:d||null},{new:!0}).then(i=>i&&i._id?(y(i._homeId,i.title,i.description,i.status,r,d,i.createdBy),a.success(t,!0,"Ticket started successfully.")):a.cError(t,"Could not start the ticket with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.addComment=((e,t)=>{if(!e.body.comment||!e.params.id)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{comments:{comment:e.body.comment||"",isActive:!0,createdBy:d||null}}},{new:!0}).then(o=>{if(!o||!o.ok||o.ok<1)return a.cError(t,"Failed to add comment.");i.findById(e.params.id,{_homeId:1,title:1,description:1,status:1,comments:[{$elemMatch:{isActive:!0}}]}).then(i=>!i||!i.comments||i.comments.length<1?a.cError(t,"Failed to add comment."):(i.comments[i.comments.length-1].createdBy.toString()==d?f(!0,i._homeId,i.title,i.description,i.status,e.body.comment,r,d):g(!0,i._homeId,i.title,i.description,i.status,e.body.comment,r,d),a.success(t,i.comments[i.comments.length-1]._id))).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.updateComment=((e,t)=>{if(!e.body.comment||!e.params.id)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findOneAndUpdate({"comments._id":e.params.id},{$set:{"comments.$.comment":e.body.comment||"","comments.$.updatedBy":d||null}},{projection:{}}).then(i=>i&&i._id?(i.comments[i.comments.length-1].createdBy.toString()==d?f(!1,i._homeId,i.title,i.description,i.status,e.body.comment,r,d):g(!1,i._homeId,i.title,i.description,i.status,e.body.comment,r,d),a.success(t,e.params.id)):a.cError(t,"Failed to update comment.")).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.deleteComment=((e,t)=>{i.update({"comments._id":e.params.id},{$pull:{comments:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?a.cError(t,"Could not delete record with id "+e.params.id):a.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>a.cError(t,"Not implemented."));const m=(e,t,r=!1)=>{e=o.clone(e);let i=[],d=[];e.map((e,t)=>{e._homeId&&i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.createdBy&&d.indexOf(e.createdBy.toString())<0&&d.push(e.createdBy),e.comments&&e.comments.length>0&&(e.comments=e.comments.reverse(),e.comments.map((e,t)=>{e.createdBy&&d.indexOf(e.createdBy.toString())<0&&d.push(e.createdBy)}))});let n=[],s=[],m=[];d&&d.length>0&&n.push(c.getNames(d).then(e=>{s=e}).catch(e=>{})),i&&i.length>0&&n.push(l.getNumbers(i).then(e=>{m=e}).catch(e=>{})),Promise.all(n).then(function(){return(s&&s.length>0||m&&m.length>0)&&e.forEach(e=>{if(s&&s.length>0){let t=s.find(t=>t._id.toString()==e.createdBy);t&&t._id&&(e.createdBy=t.name),e.comments.forEach(e=>{let t=s.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdByName=t[0].name)})}let t=m&&m.find(t=>t._id.toString()==e._homeId);return t&&t._id&&(e._homeId=t.number),e}),a.success(t,r&&e&&e.length>0?e[0]:e)}).catch(i=>a.success(t,r&&e&&e.length>0?e[0]:e))},h=(e,t,r,i,d,o,a)=>{c.getAMMailANDFCM(o).then(o=>{c.getName(a).then(a=>{l.getNumber(t).then(t=>{let c="<html><body>";c+='<div style="width: 100%; margin: 15px;">',c+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+(e?"New Ticket raised":"Ticket updated")+"</div>",c+='<div style="width: 100%;">',c+='<div style="width: 100%; margin: 5px 0px;">Home: '+t+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">'+(e?"Raised By: ":"Updated By: ")+a+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Title: '+r+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Description: '+i+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Status: '+d+"</div>",c+="</div></body></html>",n.send((e?"New Ticket raised by ":"Ticket updated by ")+a,c,o.mailIds,!0),s.send((e?"New Ticket raised by ":"Ticket updated by ")+a+" from "+t,r+": "+i,o.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},u=(e,t,r,i,d,o)=>{c.getAMMailANDFCM(d).then(d=>{c.getName(o).then(o=>{l.getNumber(e).then(e=>{let a="<html><body>";a+='<div style="width: 100%; margin: 15px;">',a+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+o+" removed the ticket.</div>",a+='<div style="width: 100%;">',a+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Title: '+t+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Description: '+r+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Status: '+i+"</div>",a+="</div></body></html>",n.send(o+" removed the ticket from "+e+".",a,d.mailIds,!0),s.send(o+" removed the ticket from "+e+".",t+": "+r,d.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},p=(e,t,r,i,d,o)=>{c.getAMMailANDFCM(d).then(d=>{c.getName(o).then(o=>{l.getNumber(e).then(e=>{let a="<html><body>";a+='<div style="width: 100%; margin: 15px;">',a+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+o+" resolved the ticket.</div>",a+='<div style="width: 100%;">',a+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Title: '+t+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Description: '+r+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Status: '+i+"</div>",a+="</div></body></html>",n.send(o+" resolved the ticket from "+e+".",a,d.mailIds,!0),s.send(o+" resolved the ticket from "+e+".",t+": "+r,d.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},y=(e,t,r,i,d,o,a)=>{c.getMailANDFCM(a).then(d=>{c.getName(o).then(o=>{l.getNumber(e).then(e=>{let a="<html><body>";a+='<div style="width: 100%; margin: 15px;">',a+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+o+" started the ticket.</div>",a+='<div style="width: 100%;">',a+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Title: '+t+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Description: '+r+"</div>",a+='<div style="width: 100%; margin: 5px 0px;">Status: '+i+"</div>",a+="</div></body></html>",n.send(o+" started the ticket for "+e+".",a,d.mailId,!0),s.send(o+" started the ticket for "+e+".",t+": "+r,[d.fcmToken])}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},f=(e,t,r,i,d,o,a,m)=>{c.getAMMailANDFCM(a).then(a=>{c.getName(m).then(c=>{l.getNumber(t).then(t=>{let l="<html><body>";l+='<div style="width: 100%; margin: 15px;">',l+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+c+(e?" commented on Ticket.":" updated the comment for the Ticket.")+"</div>",l+='<div style="width: 100%;">',l+='<div style="width: 100%; margin: 5px 0px;">Home: '+t+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Title: '+r+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Description: '+i+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Status: '+d+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Comment: '+o+"</div>",l+="</div></body></html>",n.send(c+" from "+t+(e?" commented on the ticket.":" updated the comment for the ticket."),l,a.mailIds,!0),s.send(c+" from "+t+(e?" commented on the ticket":" updated the comment for the ticket"),r+": "+o,a.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},g=(e,t,r,i,d,o,a,m)=>{c.getMailANDFCM(m).then(a=>{c.getName(m).then(c=>{l.getNumber(t).then(t=>{let l="<html><body>";l+='<div style="width: 100%; margin: 15px;">',l+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+c+(e?" commented on Ticket.":" updated the comment for the Ticket.")+"</div>",l+='<div style="width: 100%;">',l+='<div style="width: 100%; margin: 5px 0px;">Home: '+t+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Title: '+r+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Description: '+i+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Status: '+d+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Comment: '+o+"</div>",l+="</div></body></html>",n.send(c+(e?" commented on Ticket.":" updated the comment for the ticket."),l,a.mailId,!0),s.send(c+(e?" commented on the ticket":" updated the comment for the ticket"),r+": "+o,[a.fcmToken])}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})}},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({comment:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,category:String,title:String,description:String,status:String,comments:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Ticket",a)},function(e,t,r){"use strict";const i=r(2),d=r(49),o=r(0).routePrefix+"/payment";e.exports=(e=>{e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.post(o+"s/:id",i.checkToken,d.search),e.post(o+"/:id",i.checkToken,d.create),e.put(o+"/:id",i.checkToken,d.update),e.post(o+"/transaction/:id",i.checkToken,d.createTransaction)})},function(e,t,r){"use strict";const i=r(50),d=r(3),o=r(5),a=r(1),n=r(6),s=r(10);t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return a.vError(t,"Validation failed. Please send client id.");d.find({_clientId:r,isActive:!0},{_id:1}).then(e=>{if(!e||e.length<1)return a.success(t,[]);let d=[];e.map((e,t)=>{d.push(e._id)}),i.find({_clientId:r,_homeId:{$in:d},isActive:!0},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(e=>{if(!(e&&e.length>0))return a.success(t,[]);{e=o.clone(e);let r=[],i=[];if(e.forEach(e=>{e.createdBy&&r.indexOf(e.createdBy.toString())<0&&r.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse(),e.transactions.map((e,t)=>{e.createdBy&&r.indexOf(e.createdBy.toString())<0&&r.push(e.createdBy)}))}),!(i&&i.length>0))return a.success(t,e);s.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let t=i.filter(t=>t._id.toString()==e._homeId);t&&t.length>0&&t[0]._id&&(e._homeId=t[0].number)}),!(r&&r.length>0))return a.success(t,e);n.getNames(r).then(r=>(r&&r.length>0&&e.forEach(e=>{let t=r.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdBy=t[0].name),e.transactions.forEach(e=>{let t=r.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdBy=t[0].name)})}),a.success(t,e))).catch(r=>a.success(t,e))}).catch(r=>a.success(t,e))}}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findAllByHome=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return a.vError(t,"Validation failed. Please send client id.");i.find({_clientId:r,_homeId:e.params.id,isActive:!0},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(e=>{if(!(e&&e.length>0))return a.success(t,[]);{e=o.clone(e);let r=[],i=[];if(e.forEach(e=>{e.createdBy&&r.indexOf(e.createdBy.toString())<0&&r.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse(),e.transactions.map((e,t)=>{e.createdBy&&r.indexOf(e.createdBy.toString())<0&&r.push(e.createdBy)}))}),!(i&&i.length>0))return a.success(t,e);s.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let t=i.filter(t=>t._id.toString()==e._homeId);t&&t.length>0&&t[0]._id&&(e._homeId=t[0].number)}),!(r&&r.length>0))return a.success(t,e);n.getNames(r).then(r=>(r&&r.length>0&&e.forEach(e=>{let t=r.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdBy=t[0].name),e.transactions.forEach(e=>{let t=r.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdBy=t[0].name)})}),a.success(t,e))).catch(r=>a.success(t,e))}).catch(r=>a.success(t,e))}}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.create=((e,t)=>{if(!(e.params.id&&e.body.amount&&e.body.month>=0&&e.body.year&&(e.body.isAllHome||e.body.homes)))return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.params.id,o=e.headers["user-id"]||"";i.find({_clientId:r,forMonth:e.body.month,forYear:e.body.year},{_id:1,_homeId:1}).then(n=>{(!n||n.length<1)&&(n=[]),d.find({_clientId:r,isActive:!0},{_id:1}).then(d=>{if(!d||d.length<1)return a.cError(t,"No home found to create payment.");if(!(d.length>n.length))return a.cError(t,"Payment is already created for all homes. If you want to edit, Please go to payment history then serach and edit.");{e.body.isAllHome||(d=d.filter((t,r)=>e.body.homes.indexOf(t._id.toString())>=0)),n&&n.length>0&&(d=d.filter((e,t)=>n.filter((t,r)=>t._homeId.toString()==e._id.toString()).length<1));let s=[];if(d.map((t,d)=>{s.push(new i({_clientId:r,_homeId:t._id,amount:e.body.amount||0,mode:e.body.mode||"",type:e.body.type||"",description:e.body.description||"",forMonth:e.body.month,forYear:e.body.year,transactions:[],isActive:!0,createdBy:o}))}),!(s&&s.length>0))return a.error(t,"Payment for the month you selected is already created for all homes. If you want to edit please secect home number(s) insted of All Homes.");i.insertMany(s).then(e=>!e||e.length<1?a.cError(t,"Failed to create payment."):a.success(t,!0,"Payment created successfully.")).catch(e=>a.error(t,e.message||"Some error occurred while creating payment."))}}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}).catch(e=>a.error(t,e.message||"Some error occurred while validating payment."))}),t.update=((e,t)=>{if(!e.params.id||!e.body.amount)return a.vError(t,"Validation failed. Please fill all the required fields.");e.params.id;let r=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{amount:e.body.amount,description:e.body.description||"",updatedBy:r},{new:!0}).then(r=>r&&r._id?a.success(t,!0,"Payment updated successfully."):a.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.createTransaction=((e,t)=>{if(!e.body.txnRef||!e.body.amount||!e.body.status)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{transactions:{txnRef:e.body.txnRef||"",txnId:e.body.txnId||"",amount:e.body.amount||0,status:e.body.status||"",isSuccess:e.body.isSuccess||!1,reason:e.body.reason||"",isActive:!0,createdBy:r}}},{new:!0}).then(r=>{if(!r||!r.ok||r.ok<1)return a.cError(t,"Failed to create record.");i.findById(e.params.id,{transactions:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.transactions||e.transactions.length<1?a.cError(t,"Failed to create record."):a.success(t,e.transactions[e.transactions.length-1]._id)).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.search=((e,t)=>{if(!e.params.id||e.params.id.length<1||!e.body.fromDate||!e.body.toDate)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.params.id;d.find({_clientId:r,isActive:!0},{_id:1}).then(d=>{if(!d||d.length<1)return a.success(t,[]);let c=[];e.body.homes&&e.body.homes.length>0?c=e.body.homes:d.map((e,t)=>{c.push(e._id)});let l=new Date(e.body.fromDate);l.setDate(l.getDate()-1);let m=new Date(e.body.toDate);m.setDate(m.getDate()+1),i.find({_clientId:r,_homeId:{$in:c},createdAt:{$gte:l,$lt:m},isActive:!0},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(e=>{if(!(e&&e.length>0))return a.success(t,[]);{e=o.clone(e);let r=[],i=[];if(e.forEach(e=>{e.createdBy&&r.indexOf(e.createdBy.toString())<0&&r.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse(),e.transactions.map((e,t)=>{e.createdBy&&r.indexOf(e.createdBy.toString())<0&&r.push(e.createdBy)}))}),!(i&&i.length>0))return a.success(t,e);s.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let t=i.filter(t=>t._id.toString()==e._homeId);t&&t.length>0&&t[0]._id&&(e._homeId=t[0].number)}),!(r&&r.length>0))return a.success(t,e);n.getNames(r).then(r=>(r&&r.length>0&&e.forEach(e=>{let t=r.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdBy=t[0].name),e.transactions.forEach(e=>{let t=r.filter(t=>t._id.toString()==e.createdBy);t&&t.length>0&&t[0]._id&&(e.createdBy=t[0].name)})}),a.success(t,e))).catch(r=>a.success(t,e))}).catch(r=>a.success(t,e))}}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))})},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({txnRef:String,txnId:String,amount:Number,status:String,isSuccess:Boolean,reason:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,amount:Number,mode:String,type:String,description:String,forMonth:Number,forYear:Number,transactions:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.models&&i.models.Payment?i.models.Payment:i.model("Payment",a)},function(e,t,r){"use strict";const i=r(2),d=r(52),o=r(0).routePrefix+"/ad";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(9),d=r(5),o=r(1),a=r(6);t.create=((e,t)=>{if(!e.body.title||!e.body.description)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{ads:{title:e.body.title||"",description:e.body.description||"",isActive:!0,createdBy:r}}},{new:!0}).then(r=>{if(!r||!r.ok||r.ok<1)return o.cError(t,"Failed to create record.");i.findById(e.params.id,{ads:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.ads||e.ads.length<1?o.cError(t,"Failed to create record."):o.success(t,e.ads[e.ads.length-1]._id)).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{i.findById(e.params.id,{ads:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.ads)return o.success(t,[]);let r=d.clone(e.ads),i=[];if((r=r.reverse()).map((e,t)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(t,r);a.getNames(i).then(e=>(e&&e.length>0&&r.forEach(t=>{let r=e.filter(e=>e._id.toString()==t.createdBy);r&&r.length>0&&r[0]._id&&(t.createdBy=r[0].name)}),o.success(t,r))).catch(e=>o.success(t,r))}).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findById({"ads._id":e.params.id},{ads:[{$elemMatch:{isActive:!0}}]}).then(r=>r&&r.ads?(r=r.ads.filter((t,r)=>t._id==e.params.id),o.success(t,r&&r.length>0?r[0]:null)):o.cError(t,"Record not found.")).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>{if(!e.body.title||!e.body.description)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.findOneAndUpdate({"ads._id":e.params.id},{$set:{"ads.$.title":e.body.title||"","ads.$.description":e.body.description||"","ads.$.updatedBy":r||null}},{projection:{_id:1}}).then(r=>r&&r._id?o.success(t,e.params.id):o.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{i.update({"ads._id":e.params.id},{$pull:{ads:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?o.cError(t,"Could not delete record with id "+e.params.id):o.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>o.cError(t,"Not implemented."))},function(e,t,r){"use strict";const i=r(2),d=r(54),o=r(0).routePrefix+"/document";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(3),d=r(5),o=r(1),a=r(6);t.create=((e,t)=>{if(!e.body.title||!e.body.description)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{documents:{title:e.body.title||"",description:e.body.description||"",file:e.body.file||"",isActive:!0,createdBy:r}}},{new:!0}).then(r=>{if(!r||!r.ok||r.ok<1)return o.cError(t,"Failed to create record.");i.findById(e.params.id,{documents:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.documents||e.documents.length<1?o.cError(t,"Failed to create record."):o.success(t,e.documents[e.documents.length-1]._id)).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{i.findById(e.params.id,{documents:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.documents)return o.success(t,[]);let r=d.clone(e.documents),i=[];if((r=r.reverse()).map((e,t)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(t,r);a.getNames(i).then(e=>(e&&e.length>0&&r.forEach(t=>{let r=e.filter(e=>e._id.toString()==t.createdBy);r&&r.length>0&&r[0]._id&&(t.createdBy=r[0].name)}),o.success(t,r))).catch(e=>o.success(t,r))}).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findOne({"documents._id":e.params.id},{documents:[{$elemMatch:{isActive:!0}}]}).then(r=>r&&r.documents?(r=r.documents.filter((t,r)=>t._id==e.params.id),o.success(t,r&&r.length>0?r[0]:null)):o.cError(t,"Record not found.")).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>{if(!e.body.title||!e.body.description)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.findOneAndUpdate({"documents._id":e.params.id},{$set:{"documents.$.title":e.body.title||"","documents.$.description":e.body.description||"","documents.$.file":e.body.file||"","documents.$.updatedBy":r||null}},{projection:{_id:1}}).then(r=>r&&r._id?o.success(t,e.params.id):o.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{i.update({"documents._id":e.params.id},{$pull:{documents:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?o.cError(t,"Could not delete record with id "+e.params.id):o.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>o.cError(t,"Not implemented."))},function(e,t,r){"use strict";const i=r(2),d=r(56),o=r(0).routePrefix+"/notification";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(9),d=r(5),o=r(1),a=r(6),n=r(7);t.create=((e,t)=>{if(!e.body.title||!e.body.body)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{notifications:{title:e.body.title||"",body:e.body.body||"",isActive:!0,createdBy:d}}},{new:!0}).then(d=>{if(!d||!d.ok||d.ok<1)return o.cError(t,"Failed to create record.");i.findById(e.params.id,{notifications:[{$elemMatch:{isActive:!0}}]}).then(i=>!i||!i.notifications||i.notifications.length<1?o.cError(t,"Failed to create record."):(s(e.body.title,e.body.body,r),o.success(t,i.notifications[i.notifications.length-1]._id))).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{i.findById(e.params.id,{notifications:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.notifications)return o.success(t,[]);let r=d.clone(e.notifications);r=r.reverse();let i=[];if(r.map((e,t)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(t,r);a.getNames(i).then(e=>(e&&e.length>0&&r.forEach(t=>{let r=e.filter(e=>e._id.toString()==t.createdBy);r&&r.length>0&&r[0]._id&&(t.createdBy=r[0].name)}),o.success(t,r))).catch(e=>o.success(t,r))}).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findOne({"notifications._id":e.params.id},{notifications:[{$elemMatch:{isActive:!0}}]}).then(r=>r&&r.notifications?(r=r.notifications.filter((t,r)=>t._id==e.params.id),o.success(t,r&&r.length>0?r[0]:null)):o.cError(t,"Record not found.")).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>o.cError(t,"Not implemented.")),t.delete=((e,t)=>{i.update({"notifications._id":e.params.id},{$pull:{notifications:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?o.cError(t,"Could not delete record with id "+e.params.id):o.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>o.cError(t,"Not implemented."));const s=(e,t,r)=>{a.getAllFCM(r).then(r=>{n.send(e,t,r)}).catch(e=>{})}},function(e,t,r){"use strict";const i=r(2),d=r(58),o=r(0).routePrefix+"/outing";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.delete(o+"/return/:id",i.checkToken,d.return),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(3),d=r(5),o=r(1),a=r(8),n=r(7),s=r(6);t.create=((e,t)=>{if(!e.body.fromDate||!e.body.toDate)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{outings:{fromDate:e.body.fromDate?new Date(e.body.fromDate):null,toDate:e.body.toDate?new Date(e.body.toDate):null,place:e.body.place||"",address:e.body.address||"",isReturned:!1,returnedAt:null,isActive:!0,createdBy:d}}},{new:!0}).then(a=>{if(!a||!a.ok||a.ok<1)return o.cError(t,"Failed to create record.");i.findById(e.params.id,{number:1,outings:[{$elemMatch:{isActive:!0}}]}).then(i=>!i||!i.outings||i.outings.length<1?o.cError(t,"Failed to create record."):(c(i.number,e.body.fromDate||"",e.body.toDate||"",e.body.place||"",e.body.address||"",r,d),o.success(t,i.outings[i.outings.length-1]._id))).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return o.vError(t,"Validation failed. Please send client id.");i.find({_clientId:r,isActive:!0},{number:1,outings:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||e.length<1)return o.success(t,[]);let r=[];e.map((e,t)=>{let i=e.outings.filter((e,t)=>1!=e.isReturned);i&&i.length>0&&((i=d.clone(i)).forEach(t=>{t._homeId=e.number}),r=r.concat(i))});let i=[];if((r=r.reverse()).map((e,t)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(t,r);s.getNames(i).then(e=>(e&&e.length>0&&r.forEach(t=>{let r=e.filter(e=>e._id.toString()==t.createdBy);r&&r.length>0&&r[0]._id&&(t.createdBy=r[0].name)}),o.success(t,r))).catch(e=>o.success(t,r))}).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findAllByHome=((e,t)=>{i.findById(e.params.id,{number:1,outings:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.outings)return o.success(t,[]);let r=d.clone(e.outings),i=[];if((r=r.reverse()).map((e,t)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(t,r);s.getNames(i).then(i=>(i&&i.length>0&&r.forEach(t=>{t._homeId=e.number;let r=i.filter(e=>e._id.toString()==t.createdBy);r&&r.length>0&&r[0]._id&&(t.createdBy=r[0].name)}),o.success(t,r))).catch(e=>o.success(t,r))}).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findOne({"outings._id":e.params.id},{outings:[{$elemMatch:{isActive:!0}}]}).then(r=>r&&r.outings?(r=r.outings.filter((t,r)=>t._id==e.params.id),o.success(t,r&&r.length>0?r[0]:null)):o.cError(t,"Record not found.")).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>{if(!e.body.fromDate||!e.body.toDate)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.findOneAndUpdate({"outings._id":e.params.id},{$set:{"outings.$.fromDate":e.body.fromDate?new Date(e.body.fromDate):null,"outings.$.toDate":e.body.toDate?new Date(e.body.toDate):null,"outings.$.place":e.body.place||"","outings.$.address":e.body.address||"","outings.$.updatedBy":r||null}},{projection:{_id:1}}).then(r=>r&&r._id?o.success(t,e.params.id):o.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{i.update({"outings._id":e.params.id},{$pull:{outings:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?o.cError(t,"Could not delete record with id "+e.params.id):o.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.return=((e,t)=>{let r=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findOneAndUpdate({"outings._id":e.params.id},{$set:{"outings.$.isReturned":!0,"outings.$.returnedAt":new Date,"outings.$.updatedBy":d||null}},{projection:{_id:1,number:1,outings:[{$elemMatch:{isActive:!0}}]}}).then(i=>{if(!i||!i._id)return o.cError(t,"Error updating record with id "+e.params.id);let a=i.outings.filter((t,r)=>t._id==e.params.id);return a&&a.length>0&&(a=a[0],l(i.number,a.fromDate,a.toDate,a.place,a.address,r,d)),o.success(t,!0,"Return back success.")}).catch(r=>"ObjectId"===r.kind?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.search=((e,t)=>o.cError(t,"Not implemented."));const c=(e,t,r,i,d,o,c)=>{s.getAMGMailANDFCM(o).then(o=>{s.getName(c).then(s=>{let c="<html><body>";c+='<div style="width: 100%; margin: 15px;">',c+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+s+" and family in "+e+" going for Outing to "+i+".</div>",c+='<div style="width: 100%;">',c+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">From: '+t+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">To: '+r+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Place: '+i+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Address: '+d+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">You will get notification when they return back.</div>',c+="</div></body></html>",a.send(s+" and family in "+e+" going for Outing to "+i+".",c,o.mailIds,!0),n.send(e+" going for Outing",s+" and family in "+e+" going for Outing to "+i+".",o.fcmTokens)}).catch(e=>{})}).catch(e=>{})},l=(e,t,r,i,d,o,c)=>{s.getAMGMailANDFCM(o).then(o=>{s.getName(c).then(s=>{let c="<html><body>";c+='<div style="width: 100%; margin: 15px;">',c+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+s+" and family returned from Outing in "+e+".</div>",c+='<div style="width: 100%;">',c+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">From: '+t+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">To: '+r+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Place: '+i+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Address: '+d+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Return On: '+new Date+"</div>",c+="</div></body></html>",a.send(s+" and family returned from Outing in "+e+".",c,o.mailIds,!0),n.send("Returned from Outing in "+e,s+" and family returned from Outing in "+e+".",o.fcmTokens)}).catch(e=>{})}).catch(e=>{})}},function(e,t,r){"use strict";const i=r(2),d=r(60),o=r(0).routePrefix+"/poll";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.post(o+"/vote/:id",i.checkToken,d.vote),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(61),d=r(1);r(8),r(7),r(6),r(10);t.create=((e,t)=>{if(!(e.body.topic&&e.body.description&&e.body.fromDate&&e.body.toDate&&e.body.options))return d.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";e.headers["client-id"];new i({_clientId:e.params.id,topic:e.body.topic||"",description:e.body.description||"",isAllowMultiple:e.body.isAllowMultiple||!1,isOneVotePerFlat:e.body.isOneVotePerFlat||!1,isAnonymous:e.body.isAnonymous||!1,fromDate:e.body.fromDate?new Date(e.body.fromDate):null,toDate:e.body.toDate?new Date(e.body.toDate):null,options:e.body.options||null,votes:[],isActive:!0,createdBy:r}).save().then(e=>e&&e._id?d.success(t,e._id):d.cError(t,"Data not found. Some problem occurs.")).catch(e=>d.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{if(!e.params.id)return d.vError(t,"Validation failed. Please send client id.");i.find({_clientId:e.params.id,isActive:!0}).then(e=>d.success(t,e)).catch(e=>d.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findById(e.params.id).then(r=>r?d.success(t,r):d.cError(t,"Record not found with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Error retrieving record with id "+e.params.id))}),t.update=((e,t)=>{if(!(e.body.topic&&e.body.description&&e.body.fromDate&&e.body.toDate&&e.body.options))return d.vError(t,"Validation failed. Please fill all the required fields.");e.headers["client-id"];let r=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{topic:e.body.topic||"",description:e.body.description||"",isAllowMultiple:e.body.isAllowMultiple||!1,isOneVotePerFlat:e.body.isOneVotePerFlat||!1,isAnonymous:e.body.isAnonymous||!1,fromDate:e.body.fromDate?new Date(e.body.fromDate):null,toDate:e.body.toDate?new Date(e.body.toDate):null,options:e.body.options||null,updatedBy:r},{new:!0}).then(r=>r&&r._id?d.success(t,r._id):d.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.delete=((e,t)=>{e.headers["client-id"];let r=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:r||null},{new:!0}).then(r=>r&&r._id?d.success(t,!0,"Record deleted successfully."):d.cError(t,"Could not delete record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.vote=((e,t)=>{if(!e.params.id||!e.body.votes||e.body.votes.length<1)return d.vError(t,"Validation failed. Please fill all the required fields.");e.headers["client-id"],e.headers["user-id"];i.updateOne({_id:e.params.id},{$push:{votes:{$each:e.body.votes}}},{new:!0}).then(r=>{if(!r||!r.ok||r.ok<1)return d.cError(t,"Failed to add vote.");i.findById(e.params.id,{votes:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.votes||e.votes.length<1?d.cError(t,"Failed to add vote."):d.success(t,e.votes)).catch(e=>d.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(t,e.message||"Some error occurred while creating a record."))}),t.search=((e,t)=>d.cError(t,"Not implemented."))},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({_homeId:d.Types.ObjectId,_memberId:d.Types.ObjectId,option:Number,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({_clientId:d.Types.ObjectId,topic:String,description:String,isAllowMultiple:Boolean,isOneVotePerFlat:Boolean,isAnonymous:Boolean,fromDate:Date,toDate:Date,options:[String],votes:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Poll",a)},function(e,t,r){"use strict";const i=r(2),d=r(63),o=r(0).routePrefix+"/visitor";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:isActive",i.checkToken,d.findAll),e.get(o+"s/:id/:isActive",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/enter/:id/:gateNo",i.checkToken,d.enter),e.get(o+"/exit/:id/:gateNo",i.checkToken,d.exit),e.get(o+"/approve/:id",i.checkToken,d.approve),e.get(o+"/reject/:id",i.checkToken,d.reject),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";var i=r(14);const d=r(64),o=r(3),a=r(1),n=r(5),s=r(8),c=r(7),l=r(10),m=r(6);t.create=((e,t)=>{if(!e.body.name)return a.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",n=e.headers["user-id"]||"",s=new d({_clientId:r,_homeId:e.params.id,type:e.body.type||"",name:e.body.name||"",age:e.body.age||"",gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",image:e.body.image||"",personCount:e.body.personCount||0,vehicleType:e.body.vehicleType||"",vehicleNo:e.body.vehicleNo||"",passCode:e.body.passCode||"",arriveAt:e.body.arriveAt||null,gateNo:e.body.gateNo||"",isApproved:!1,isRejected:!1,isEntered:!1,isExit:!1,isActive:!0,createdBy:n});e.body.isUser&&!0===e.body.isUser&&(s.isApproved=!0,s.passCode=i.generate().toUpperCase(),s.approvedAt=new Date,s.approvedBy=n),s.save().then(r=>{if(!r||!r._id)return a.cError(t,"Data not found. Some problem occurs.");o.findById(e.params.id,{_id:1,number:1,members:1}).then(i=>{if(!i||!i._id)return a.cError(t,"Failed to create record.");e.body.isUser&&!0===e.body.isUser||h(i.number,e.body.name,e.body.age,e.body.gender,e.body.mobileNo,e.body.emailId,e.body.image,i.members),y([r],t,!0)}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>a.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return a.vError(t,"Validation failed. Please send client id.");let i={_clientId:r,isActive:!0};"true"===e.params.isActive&&(i.isExit={$ne:!0}),d.find(i).sort({_id:-1}).then(e=>{if(!e||e.length<1)return a.success(t,[]);y(e,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findAllByHome=((e,t)=>{let r={_homeId:e.params.id,isActive:!0};"true"===e.params.isActive&&(r.isExit={$ne:!0}),d.find(r).sort({_id:-1}).then(e=>{if(!e||e.length<1)return a.success(t,[]);y(e,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{d.findById(e.params.id).then(r=>{if(!r||!r._id)return a.cError(t,"Record not found with id "+e.params.id);y([r],t,!0)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>a.cError(t,"Not implemented.")),t.delete=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:r||null}).then(r=>r&&r._id?a.success(t,!0,"Record deleted successfully."):a.cError(t,"Could not delete record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.enter=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isEntered:!0,enteredBy:r||null,enteredAt:new Date,gateNo:e.params.gateNo},{new:!0}).then(r=>r&&r._id?a.success(t,!0,"Visitor entry success."):a.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.exit=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isExit:!0,exitBy:r||null,exitAt:new Date,exitGateNo:e.params.gateNo},{new:!0}).then(r=>r&&r._id?a.success(t,!0,"Visitor exit success."):a.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.approve=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isApproved:!0,approvedBy:r||null,approvedAt:new Date},{new:!0}).then(r=>{if(!r||!r._id)return a.cError(t,"Error updating record with id "+e.params.id);o.findById(r._homeId,{_id:1,number:1,members:1}).then(i=>i&&i._id?(u(i.number,e.body.name,r.createdBy),a.success(t,!0,"Visitor approve success.")):a.cError(t,"Failed to create record.")).catch(e=>a.success(t,!0,"Visitor approve success."))}).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.reject=((e,t)=>{let r=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isRejected:!0,approvedBy:r||null,approvedAt:new Date},{new:!0}).then(r=>{if(!r||!r._id)return a.cError(t,"Error updating record with id "+e.params.id);o.findById(r._homeId,{_id:1,number:1,members:1}).then(i=>i&&i._id?(p(i.number,e.body.name,r.createdBy),a.success(t,!0,"Visitor approve success.")):a.cError(t,"Failed to create record.")).catch(e=>a.success(t,!0,"Visitor approve success."))}).catch(r=>"ObjectId"===r.kind?a.nError(t,"Record not found with id "+e.params.id):a.error(t,"Internal server error. Error updating record with id "+e.params.id))}),t.search=((e,t)=>{let r=new RegExp(e.params.text,"i");d.aggregate([{$match:{$and:[{$or:[{name:r},{mobileNo:r},{emailId:r},{vehicleNo:r}],isActive:!0}]}},{$group:{_id:"$mobileNo",data:{$last:"$$ROOT"}}}]).then(e=>{if(!e||e.length<1)return a.success(t,[]);let r=[];e.map(e=>{r.push(e.data)}),y(r,t)}).catch(e=>a.error(t,e.message||"Some error occurred while retrieving records."))});const h=(e,t,r,i,d,o,a,n)=>{m.getMailANDFCMs(n).then(n=>{let l="<html><body>";l+='<div style="width: 100%; margin: 15px;">',l+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">Visitor arrived to your Home '+e+". Please login to the app and approve if security want to allow him/her to visit your home.</div>",l+='<div style="width: 100%;">';let m="Please login to the app and approve if security want to allow him/her to visit your home.";t&&t.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Name: '+t+"</div>",m+=t),r>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Age: '+r+"</div>",m+=(m.length>0?", ":"")+r),i&&i.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Gender: '+("M"==i?"Male":"F"==i?"Female":"")+"</div>",m+=(m.Length>0?", ":"")+("M"==data.Gender?"Male":"F"==data.Gender?"Female":"")),d&&d.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Mobile Number: '+d+"</div>",m+=(m.Length>0?", ":"")+d),o&&o.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Email Id: '+o+"</div>",m+=(m.Length>0?", ":"")+o),a&&a.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Image: </div>',l+='<div style="width: 100%; margin: 5px 0px;"><img src="'+a+'" alt="Visitor" height="250" width="250" /></div>'),l+="</div></body></html>",s.send("Visitor arrived to your Home "+e,l,n.mailIds,!0),c.send("Visitor arrived to your Home "+e,m,n.fcmTokens)}).catch(e=>{})},u=(e,t,r)=>{m.getMailANDFCM(r).then(r=>{let i="Member from "+e+" approved "+t+" to visit their home. Please login to the app and allow entry to visit.";c.send("Visitor approval from "+e,i,r.fcmToken)}).catch(e=>{})},p=(e,t,r)=>{m.getMailANDFCM(r).then(r=>{let i="Member from "+e+" rejected "+t+" to visit their home. Please inform the visitor that he can not visit.";c.send("Visitor rejected from "+e,i,r.fcmToken)}).catch(e=>{})};let y=(e,t,r=!1)=>{e=n.clone(e);let i=[],d=[];e.map((e,t)=>{e._homeId&&i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.createdBy&&d.indexOf(e.createdBy.toString())<0&&d.push(e.createdBy),e.approvedBy&&d.indexOf(e.approvedBy.toString())<0&&d.push(e.approvedBy),e.enteredBy&&d.indexOf(e.enteredBy.toString())<0&&d.push(e.enteredBy),e.exitBy&&d.indexOf(e.exitBy.toString())<0&&d.push(e.exitBy)});let o=[],s=[],c=[];d&&d.length>0&&o.push(m.getNames(d).then(e=>{s=e}).catch(e=>{})),i&&i.length>0&&o.push(l.getNumbers(i).then(e=>{c=e}).catch(e=>{})),Promise.all(o).then(function(){return(s&&s.length>0||c&&c.length>0)&&e.forEach(e=>{if(s&&s.length>0){let t=s.find(t=>t._id.toString()==e.createdBy);t&&t._id&&(e.createdBy=t.name),(t=e.approvedBy&&s.find(t=>t._id.toString()==e.approvedBy))&&t._id&&(e.approvedBy=t.name),(t=e.enteredBy&&s.find(t=>t._id.toString()==e.enteredBy))&&t._id&&(e.enteredBy=t.name),(t=e.exitBy&&s.find(t=>t._id.toString()==e.exitBy))&&t._id&&(e.exitBy=t.name)}let t=c&&c.find(t=>t._id.toString()==e._homeId);return t&&t._id&&(e.homeNumber=t.number),e}),a.success(t,r&&e&&e.length>0?e[0]:e)}).catch(i=>a.success(t,r&&e&&e.length>0?e[0]:e))}},function(e,t,r){const i=r(4);var d=i.Schema;const o=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,type:String,name:String,age:Number,gender:String,mobileNo:String,emailId:String,image:String,personCount:Number,vehicleType:String,vehicleNo:String,passCode:String,arriveAt:{type:Date,default:null},gateNo:String,exitGateNo:String,isApproved:Boolean,isRejected:Boolean,approvedBy:{type:d.Types.ObjectId,default:null},approvedAt:{type:Date,default:null},isEntered:Boolean,enteredBy:{type:d.Types.ObjectId,default:null},enteredAt:{type:Date,default:null},isExit:Boolean,exitBy:{type:d.Types.ObjectId,default:null},exitAt:{type:Date,default:null},isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Visitor",o)},function(e,t,r){"use strict";const i=r(2),d=r(66),o=r(0).routePrefix+"/home";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search),e.get(o+"/checkno/:num",i.checkToken,d.checkNum)})},function(e,t,r){"use strict";const i=r(3),d=r(1);t.create=((e,t)=>{if(!e.body._blockId||!e.body.number)return d.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",o=e.headers["user-id"]||"";i.findOne({number:e.body.number,isActive:!0},{_id:1}).then(a=>{if(a&&a._id)return d.cError(t,"Home with same number already exists. So please try with different number.");new i({_clientId:r,_blockId:e.body._blockId,number:e.body.number||"",address:e.body.address||"",bedRoom:e.body.bedRoom||0,parking:e.body.parking||"",description:e.body.description||"",members:e.body.memberIds||[],vehicles:[],outings:[],documents:[],isActive:!0,createdBy:o||null}).save().then(e=>e&&e._id?d.success(t,e._id):d.cError(t,"Failed to create home.")).catch(e=>d.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(t,e.message||"Some error occurred while retrieving records."))}),t.findAll=((e,t)=>{let r=e.headers["client-id"]||"";if(!r||r.length<1)return d.vError(t,"Validation failed. Please send client id.");i.find({_clientId:e.params.id,isActive:!0},{_id:1,_blockId:1,number:1,members:1}).then(e=>d.success(t,e)).catch(e=>d.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findById(e.params.id).then(r=>r?d.success(t,r):d.cError(t,"Record not found with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Error retrieving record with id "+e.params.id))}),t.update=((e,t)=>{if(!e.body._blockId||!e.body.number)return d.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.findOne({number:e.body.number,isActive:!0},{_id:1}).then(o=>{if(o&&o._id&&o._id!=e.params.id)return d.cError(t,"Home with same number already exists. So please try with different number.");i.findByIdAndUpdate(e.params.id,{_blockId:e.body._blockId,number:e.body.number||"",address:e.body.address||"",bedRoom:e.body.bedRoom||0,parking:e.body.parking||"",description:e.body.description||"",members:e.body.memberIds||[],updatedBy:r},{new:!0}).then(r=>r&&r._id?d.success(t,r._id):d.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Internal server error. Error updating record with id "+e.params.id))}).catch(e=>d.error(t,e.message||"Some error occurred while retrieving records."))}),t.delete=((e,t)=>{let r=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:r||null}).then(r=>r&&r._id?d.success(t,!0,"Record deleted successfully."):d.cError(t,"Could not delete record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?d.nError(t,"Record not found with id "+e.params.id):d.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>{i.find({$and:[{$or:[{number:new RegExp(e.params.text,"i")}],isActive:!0}]}).then(e=>d.success(t,e)).catch(e=>d.error(t,e.message||"Some error occurred while retrieving records."))}),t.checkNum=((e,t)=>{i.find({number:e.params.num},{_id:1}).then(e=>!e||!e.length>0?d.success(t,!1):d.success(t,!0)).catch(e=>d.error(t,e.message||"Some error occurred while retrieving records."))})},function(e,t,r){"use strict";const i=r(2),d=r(68),o=r(0).routePrefix+"/block";e.exports=(e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)})},function(e,t,r){"use strict";const i=r(9),d=r(3),o=r(1);t.create=((e,t)=>{if(!e.body.name)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["client-id"]||"",a=e.headers["user-id"]||"";i.findOne({"blocks.name":e.params.name},{blocks:[{$elemMatch:{isActive:!0}}]}).then(n=>{if(n&&n.blocks&&!(n.blocks.length<1))return o.cError(t,"Block with same name already exists. So please try with different name.");i.updateOne({_id:e.params.id},{$push:{blocks:{name:e.body.name||"",description:e.body.description||"",isActive:!0,createdBy:a}}},{new:!0}).then(n=>{if(!n||!n.ok||n.ok<1)return o.cError(t,"Failed to create record.");i.findById(e.params.id,{blocks:[{$elemMatch:{isActive:!0}}]}).then(i=>{if(!i||!i.blocks||i.blocks.length<1)return o.cError(t,"Failed to create record.");let n=i.blocks[i.blocks.length-1]._id;if(!(e.body.homeCount&&e.body.homeCount>0))return o.success(t,{blockId:n});{let i=[];for(let t=1;t<=e.body.homeCount;t++)i.push(new d({_clientId:r,_blockId:n,number:e.body.name+t,address:"",bedRoom:1,parking:"",description:"",members:[],vehicles:[],outings:[],documents:[],isActive:!0,createdBy:a||null}));d.insertMany(i).then(e=>{if(e&&e.length>0){let r=e.map(e=>({_id:e._id,_blockId:e._blockId,number:e.number,members:e.members}));return o.success(t,{blockId:n,homes:r})}return o.success(t,{blockId:n})}).catch(e=>o.success(t,{blockId:n}))}}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}),t.findAll=((e,t)=>{i.findById(e.params.id,{blocks:[{$elemMatch:{isActive:!0}}]}).then(e=>e&&e.blocks?o.success(t,e.blocks):o.success(t,[])).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.findOne=((e,t)=>{i.findOne({"blocks._id":e.params.id},{blocks:[{$elemMatch:{isActive:!0}}]}).then(r=>r&&r.blocks?(r=r.blocks.filter((t,r)=>t._id==e.params.id),o.success(t,r&&r.length>0?r[0]:null)):o.cError(t,"Record not found.")).catch(e=>o.error(t,e.message||"Some error occurred while retrieving data."))}),t.update=((e,t)=>{if(!e.body.name)return o.vError(t,"Validation failed. Please fill all the required fields.");let r=e.headers["user-id"]||"";i.findOne({"blocks.name":e.params.name},{blocks:[{$elemMatch:{isActive:!0}}]}).then(d=>{(!d||!d.blocks||d.blocks.length<1||d.blocks[0]._id==e.params.id)&&i.findOneAndUpdate({"blocks._id":e.params.id},{$set:{"blocks.$.name":e.body.name||"","blocks.$.description":e.body.description||"","blocks.$.updatedBy":r||null}},{projection:{_id:1}}).then(r=>r&&r._id?o.success(t,e.params.id):o.cError(t,"Error updating record with id "+e.params.id)).catch(r=>"ObjectId"===r.kind?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Error updating record with id "+e.params.id))}).catch(e=>o.error(t,e.message||"Some error occurred while creating a record."))}),t.delete=((e,t)=>{i.update({"blocks._id":e.params.id},{$pull:{blocks:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(r=>!r||!r.ok||r.ok<1?o.cError(t,"Could not delete record with id "+e.params.id):o.success(t,!0,"Record deleted successfully.")).catch(r=>"ObjectId"===r.kind||"NotFound"===r.name?o.nError(t,"Record not found with id "+e.params.id):o.error(t,"Internal server error. Could not delete record with id "+e.params.id))}),t.search=((e,t)=>o.cError(t,"Not implemented."))},function(e,t,r){"use strict";const i=r(2);var d=r(70);const o=r(0).routePrefix+"/upload",a=d.diskStorage({destination(e,t,r){r(null,"./assets/file")},filename(e,t,r){r(null,`${t.originalname}`)}}),n=d({storage:a});e.exports=(e=>{e.post(o,i.checkToken,(e,t,r)=>{n.single("file")(e,t,function(e){return e instanceof d.MulterError?t.send(e):e?t.send(e):t.send({data:!0,message:""})})})})},function(e,t){e.exports=require("multer")}]);