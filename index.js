!function(e){var r={};function t(i){if(r[i])return r[i].exports;var d=r[i]={i:i,l:!1,exports:{}};return e[i].call(d.exports,d,d.exports,t),d.l=!0,d.exports}t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var d in e)t.d(i,d,function(r){return e[r]}.bind(null,d));return i},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=13)}([function(e,r){r.success=(e,r,t="")=>e.send({data:r,message:t}),r.unAuthorized=(e,r)=>error(e,401,r),r.error=(e,r)=>{error(e,500,r)},r.vError=(e,r)=>error(e,400,r),r.cError=(e,r)=>error(e,404,r),r.nError=(e,r)=>error(e,404,r),error=(e,r,t)=>e.status(r).send({message:t})},function(e,r,t){const i=t(11),d=t(12),o=t(0);r.checkToken=(e,r,t)=>{let n=e.headers["x-access-token"]||e.headers.authorization;n&&n.startsWith("Bearer ")&&(n=n.slice(7,n.length)),n?i.verify(n,d.secret,(i,d)=>{i?o.unAuthorized(r,"Token is not valid."):(e.decoded=d,t())}):o.unAuthorized(r,"Authentication token is not supplied.")}},function(e,r,t){const i=t(5);var d=i.Schema;const o=i.Schema({number:String,type:String,image:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({name:String,age:Number,gender:String,mobileNo:String,emailId:String,image:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({name:String,age:Number,gender:String,mobileNo:String,emailId:String,image:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),s=i.Schema({fromDate:Date,toDate:Date,place:String,address:String,isReturned:Boolean,returnedAt:Date,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),c=i.Schema({title:String,description:String,file:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),l=i.Schema({_clientId:d.Types.ObjectId,_blockId:d.Types.ObjectId,number:String,address:String,bedRoom:Number,parking:String,description:String,members:[d.Types.ObjectId],vehicles:[o],servents:[n],visitors:[a],outings:[s],documents:[c],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Home",l)},function(e,r){r.clone=e=>JSON.parse(JSON.stringify(e))},function(e,r,t){"use strict";const i=t(9);r.getName=e=>new Promise((function(r,t){i.findById(e,{name:1}).then(e=>{let t="";e&&e.name&&(t=e.name),r(t)}).catch(e=>{t(e)})})),r.getNames=e=>new Promise((function(r,t){i.find({_id:{$in:e}},{_id:1,name:1}).then(e=>{let t=[];e&&e.length>0&&e.map((e,r)=>{t.push({_id:e._id,name:e.name})}),r(t)}).catch(e=>{t(e)})})),r.getAMMailId=e=>new Promise((function(r,t){i.find({$and:[{_clientId:e,isActive:!0},{$or:[{role:{$regex:"ADMIN",$options:"i"}},{role:{$regex:"MANAGER",$options:"i"}}]}]},{emailId:1}).then(e=>{let t="";e&&e.length>0&&e.map((e,r)=>{e.emailId&&e.emailId.length>0&&(t+=(e.emailId.length>0?",":"")+e.emailId)}),r(t)}).catch(e=>{t(e)})})),r.getMailANDFCM=e=>new Promise((function(r,t){i.findById(e,{_id:1,emailId:1,fcmToken:1}).then(e=>{let t="",i="";e&&e._id&&(t=e.emailId,i=e.fcmToken),r({mailId:t,fcmTokens:i})}).catch(e=>{t(e)})})),r.getMailANDFCMs=e=>new Promise((function(r,t){i.find({_id:{$in:e},isActive:!0},{emailId:1,fcmToken:1}).then(e=>{let t="",i=[];e&&e.length>0&&e.map((e,r)=>{e.emailId&&e.emailId.length>0&&(t+=(e.emailId.length>0?",":"")+e.emailId),e.fcmToken&&e.fcmToken.length>0&&i.push(e.fcmToken)}),r({mailIds:t,fcmTokens:i})}).catch(e=>{t(e)})})),r.getAMMailANDFCM=e=>new Promise((function(r,t){i.find({$and:[{_clientId:e,isActive:!0},{$or:[{role:{$regex:"ADMIN",$options:"i"}},{role:{$regex:"MANAGER",$options:"i"}}]}]},{emailId:1,fcmToken:1}).then(e=>{let t="",i=[];e&&e.length>0&&e.map((e,r)=>{e.emailId&&e.emailId.length>0&&(t+=(e.emailId.length>0?",":"")+e.emailId),e.fcmToken&&e.fcmToken.length>0&&i.push(e.fcmToken)}),r({mailIds:t,fcmTokens:i})}).catch(e=>{t(e)})})),r.getAllFCM=e=>new Promise((function(r,t){i.find({_clientId:e,isActive:!0},{fcmToken:1}).then(e=>{let t=[];e&&e.length>0&&e.map((e,r)=>{e.fcmToken&&e.fcmToken.length>0&&t.push(e.fcmToken)}),r(t)}).catch(e=>{t(e)})})),r.getAMGMailANDFCM=e=>new Promise((function(r,t){i.find({$and:[{_clientId:e,isActive:!0},{$or:[{role:{$regex:"ADMIN",$options:"i"}},{role:{$regex:"MANAGER",$options:"i"}},{role:{$regex:"GATEKEEPER",$options:"i"}}]}]},{emailId:1,fcmToken:1}).then(e=>{let t="",i=[];e&&e.length>0&&e.map((e,r)=>{e.emailId&&e.emailId.length>0&&(t+=(e.emailId.length>0?",":"")+e.emailId),e.fcmToken&&e.fcmToken.length>0&&i.push(e.fcmToken)}),r({mailIds:t,fcmTokens:i})}).catch(e=>{t(e)})}))},function(e,r){e.exports=require("mongoose")},function(e,r,t){const i=t(5);var d=i.Schema;const o=i.Schema({name:String,description:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({title:String,description:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),a=i.Schema({title:String,body:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),s=i.Schema({name:String,description:String,address:String,upi:{id:String,name:String},rep:{name:String,mobileNo:String,emailId:String,repType:String},blocks:[o],ads:[n],notifications:[a],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Client",s)},function(e,r,t){const i=t(27),d=t(28);r.send=(e,r,t,o)=>{if(d.isSend){(!t||t.length<1)&&(t=d.to);let n=i.createTransport({host:d.host,port:d.port,secure:d.isSecure,auth:{user:d.userName,pass:d.password}}),a={from:d.from,to:t,subject:e,text:o?"":r,html:o?r:""};n.sendMail(a,(e,r)=>(n.close(),!e||(console.log("Email not sent: ",e),!1)))}}},function(e,r,t){const i=t(38),d=t(39);r.send=(e,r,t)=>{if(d.isSend&&t&&t.length>0){let o={registration_ids:t,notification:{title:e,body:r},data:{title:e,body:r}};new i(d.serverKey).send(o,(function(e,r){e&&console.log("Something has gone wrong in FCM: ",e)}))}}},function(e,r,t){const i=t(5);var d=i.Schema;const o=i.Schema({_clientId:d.Types.ObjectId,number:String,name:String,age:Number,gender:String,mobileNo:String,emailId:String,password:String,type:String,role:String,image:String,fcmToken:String,os:String,osVersion:String,isApproved:Boolean,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Member",o)},function(e,r,t){"use strict";const i=t(2);r.getNumber=e=>new Promise((function(r,t){i.findById(e,{number:1}).then(e=>{let t="";e&&e.number&&(t=e.number),r(t)}).catch(e=>{t(e)})})),r.getNumbers=e=>new Promise((function(r,t){i.find({_id:{$in:e}},{_id:1,number:1}).then(e=>{let t=[];e&&e.length>0&&e.map((e,r)=>{t.push({_id:e._id,number:e.number})}),r(t)}).catch(e=>{t(e)})}))},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports={secret:"mynestappbynaveenkumard"}},function(e,r,t){const i=t(14),d=t(15);var o=t(16);const n=t(17),a=t(5);var s=i(),c=process.env.PORT||3001;s.use(d.urlencoded({extended:!0})),s.use(d.json()),s.use(o({credentials:!0,origin:!0})),a.Promise=global.Promise,a.connect(n.url,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(()=>{console.log("Successfully connected to the database")}).catch(e=>{console.log("Could not connect to the database. Exiting now...",e),process.exit()}),s.use(i.static("assets")),s.use(i.static("web")),s.get("/",(e,r)=>{var t=url.parse(e.url,!0);let i="/index.html";t.pathname&&t.pathname.length>0&&"/#"!=t.pathname.substring(0,2)&&(i=t.pathname),r.sendFile("./web"+i,{root:"./"})}),t(18)(s),s.listen(c,()=>{console.log("API Server is listening on port "+c)})},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("cors")},function(e,r){e.exports={url:"mongodb+srv://naveen:nvnkmr%40123@cluster0-r86wa.mongodb.net/nest?retryWrites=true&w=majority"}},function(e,r,t){"use strict";e.exports=e=>{t(19)(e),t(21)(e),t(23)(e),t(29)(e),t(31)(e),t(33)(e),t(35)(e),t(40)(e),t(43)(e),t(45)(e),t(47)(e),t(49)(e),t(51)(e),t(54)(e),t(56)(e),t(58)(e),t(60)(e)}},function(e,r,t){"use strict";const i=t(20);e.exports=e=>{e.route("/heartbeat").get(i.get)}},function(e,r,t){"use strict";const i=t(0);r.get=(e,r)=>i.success(r,null,"API is alive.")},function(e,r,t){"use strict";const i=t(1),d=t(22),o="/client";e.exports=e=>{e.post(o,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(6),d=t(2),o=t(9),n=t(0);r.create=(e,r)=>{if(!(e.body.name&&e.body.repName&&e.body.repMobileNo&&e.body.repType&&e.body.adminName&&e.body.adminAge&&e.body.adminGender&&e.body.adminMobileNo&&e.body.adminEmailId&&e.body.adminPassword))return n.vError(r,"Please fill all the required fields.");let t=e.headers["user-id"]||"";new i({name:e.body.name,description:e.body.description||"",address:e.body.address||"",upi:{id:e.body.upiId||"",name:e.body.upiName||""},rep:{name:e.body.repName||"",mobileNo:e.body.repMobileNo||"",emailId:e.body.repEmailId||"",repType:e.body.repType||""},blocks:[{name:"COMMITTEE",description:"Block for committee members.",isActive:!0}],ads:[],polls:[],notifications:[],isActive:!0,createdBy:t||null}).save().then(i=>{if(!i||!i.blocks||i.blocks.length<1)return n.cError(r,"Failed to load client.");new o({_clientId:i._id,number:"CM0001",name:e.body.adminName||"",age:e.body.adminAge||0,gender:e.body.adminGender||"",mobileNo:e.body.adminMobileNo||"",emailId:e.body.adminEmailId||"",password:e.body.adminPassword||"",type:"ADMIN",role:"ADMIN,MANAGER,USER,GATEKEEPER",image:"",fcmToken:"",os:"",osVersion:"",isActive:!0,createdBy:t||null}).save().then(e=>{if(!e||!e._id)return n.cError(r,"Failed to load member.");new d({_clientId:i._id,_blockId:i.blocks[0]._id,number:"C0001",address:"COMMITTEE",bedRoom:0,description:"",members:[e._id],vehicles:[],servents:[],tickets:[],visitors:[],payments:[],outings:[],documents:[],isActive:!0,createdBy:t||null}).save().then(e=>e&&e._id?n.success(r,i._id):n.cError(r,"Failed to load home.")).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{i.find().then(e=>n.success(r,e)).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findById(e.params.id).then(t=>t?n.success(r,t):n.cError(r,"Record not found with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Error retrieving record with id "+e.params.id))},r.update=(e,r)=>{if(!(e.body.name&&e.body.repName&&e.body.repMobileNo&&e.body.repType))return n.vError(r,"Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{name:e.body.name,description:e.body.description||"",address:e.body.address||"",upi:{id:e.body.upiId||"",name:e.body.upiName||""},rep:{name:e.body.repName||"",mobileNo:e.body.repMobileNo||"",emailId:e.body.repEmailId||"",repType:e.body.repType||""},updatedBy:t},{new:!0}).then(t=>t?n.success(r,t._id):n.cError(r,"Record not found with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Error updating record with id "+e.params.id))},r.delete=(e,r)=>{let t=e.headers["user-id"]||"";o.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:t||null}).then(t=>t?n.success(r,!0,"Record deleted successfully."):n.cError(r,"Record not found with id "+e.params.id)).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Could not delete record with id "+e.params.id))},r.search=(e,r)=>{i.find({name:new RegExp(e.params.text,"i")}).then(e=>n.success(r,e)).catch(e=>n.error(r,e.message||"Some error occurred while retrieving records."))}},function(e,r,t){"use strict";const i=t(1),d=t(24),o="/account";e.exports=e=>{e.post(o+"/login",d.login),e.get(o+"/profile",i.checkToken,d.profile),e.post(o+"/changepassword/:id",i.checkToken,d.changePassword),e.post(o+"/resetpassword",d.resetPassword),e.put(o+"/profile/:id",i.checkToken,d.updateProfile),e.post(o+"/signup",d.signUp)}},function(e,r,t){"use strict";const i=t(11);var d=t(25);const o=t(12),n=t(6),a=t(2),s=t(9),c=t(26),l=t(3),m=t(0),h=t(7);r.login=(e,r)=>{if(!e.body.userName||!e.body.password)return m.vError(r,"Validation failed. Please fill all the required fields.");s.find({$and:[{mobileNo:e.body.userName,password:e.body.password,isActive:!0}]},{_id:1,_clientId:1,number:1,name:1}).then(t=>{if(!t||t.length<1)return m.cError(r,"User not found.");(e.body.fcmToken||e.body.os||e.body.osVersion)&&s.findByIdAndUpdate(t[0]._id,{fcmToken:e.body.fcmToken||"",os:e.body.os||"",osVersion:e.body.osVersion||""},{new:!0}).then(e=>{}).catch(e=>{});let d=i.sign({username:e.body.userName},o.secret,{expiresIn:"24h"});return m.success(r,{token:d,userId:t[0]._id,clientId:t[0]._clientId})}).catch(e=>"ObjectId"===e.kind?m.nError(r,"User not found."):m.error(r,"Internal Server Error."))},r.profile=(e,r)=>{let t=e.headers["user-id"]||"",i=e.headers["client-id"]||"";if(!t||t.length<1||!i||i.length<1)return m.vError(r,"Validation failed. Please send user id and client id.");let d={$elemMatch:{isActive:!0}};s.find({$and:[{_id:t,isActive:!0}]},{number:1,name:1,age:1,gender:1,mobileNo:1,emailId:1,type:1,role:1,image:1,createdBy:1}).then(e=>{if(!e||e.length<1)return m.cError(r,"User not found.");(e=l.clone(e[0])).createdBy&&s.findOne({_id:e.createdBy},{name:1}).then(r=>{r&&r.name&&(e.createdBy=r.name)}).catch(r=>{e.createdBy=""}),a.find({$and:[{members:{$all:[e._id]},isActive:!0}]},{_blockId:.1,number:.1,address:.1,bedRoom:.1,parking:1,description:.1,members:1,vehicles:[d],servents:[d],visitors:[d]}).then(t=>{if(!t||t.length<1)return m.success(r,e);let o=t.map(e=>e._blockId);e.homes=l.clone(t),n.find({$and:[{_id:i,isActive:!0}]},{name:1,description:1,address:1,upi:1,rep:1,blocks:[{$elemMatch:{_id:{$in:o},isActive:!0}}]}).then(t=>{if(!t||t.length<1)return m.success(r,e);t=t[0],e.homes.forEach(e=>{e.block=t.blocks.find(r=>r._id==e._blockId)}),delete(t=l.clone(t)).blocks,e.client=t;let i=[],o=[];e.homes.map((e,r)=>{i=i.concat(e.members),o.push(e._id)}),s.find({$and:[{_id:{$in:i},isActive:!0}]},{number:1,name:1,age:1,gender:1,mobileNo:1,emailId:1,type:1,role:1,image:1}).then(t=>{t&&t.length>0&&(t=l.clone(t),e.homes.forEach(e=>{e.payments=[],e.memberIds=e.members,e.members=t.filter((e,r)=>i.includes(e._id))})),c.find({$and:[{_homeId:{$in:o},isActive:!0}]},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[d],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(t=>(t&&t.length>0&&(t=l.clone(t),e.homes.forEach(e=>{e.payments=t.filter((r,t)=>r._homeId==e._id),e.payments&&e.payments.length>0&&(e.payments=e.payments.reverse(),e.payments.forEach(e=>{e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse())}))})),m.success(r,e))).catch(t=>m.success(r,e))}).catch(t=>m.success(r,e))}).catch(t=>m.success(r,e))}).catch(t=>m.success(r,e))}).catch(e=>"ObjectId"===e.kind?m.nError(r,"User not found."):m.error(r,"Internal Server Error."))},r.changePassword=(e,r)=>{if(!e.params.id||!e.body.password||!e.body.newPassword)return m.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";s.findOneAndUpdate({_id:e.params.id,password:e.body.password},{password:e.body.newPassword||"",updatedBy:t},{new:!0}).then(e=>e&&e._id?m.success(r,!0):m.success(r,!1,"Please enter the valid password.")).catch(t=>"ObjectId"===t.kind?m.nError(r,"Record not found with id "+e.params.id):m.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.resetPassword=(e,r)=>{if(!e.body.mobileNo||!e.body.emailId)return m.vError(r,"Validation failed. Please fill all the required fields.");s.findOne({mobileNo:e.body.mobileNo,emailId:e.body.emailId,isActive:!0},{_id:1}).then(t=>{if(t&&t._id){let i=d.generate();s.findByIdAndUpdate(t._id,{password:i}).then(t=>{if(!t||!t._id)return m.cError(r,"User not found.");let d="<html><body>";return d+='<div style="width: 100%; margin: 15px;">',d+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">Nest Password Reset</div>',d+='<div style="width: 100%;">',d+='<div style="width: 100%; margin: 5px 0px;">Your new password: '+i+"</div>",d+='<div style="width: 100%; margin: 5px 0px;">Change your password after login.</div>',d+="</div>",d+="</body></html>",h.send("Nest Password Reset",d,e.body.emailId,!0),m.success(r,{data:!0,message:""})}).catch(e=>m.error(r,e.message||"Some error occurred while updating data."))}else s.findOne({mobileNo:e.body.mobileNo,isActive:!0},{_id:1,emailId:1}).then(t=>{if(t&&t._id&&t.emailId&&!(t.emailId.length<1)){let e=t.emailId.split("@");if(e&&e.length>1){let t=e[0].length>3?e[0].substr(e[0].length-3,3):e[0];return m.success(r,{data:!1,message:"Email Id entered not matches. Email Id ends with "+t+" is associated with the Mobile Number you entered. So you can use that Email Id."})}return m.success(r,{data:!1,message:"No valid Email Id available for the Mobile Number you entered. So please contact administartor to update your email Id."})}s.findOne({emailId:e.body.emailId,isActive:!0},{_id:1,mobileNo:1}).then(e=>{if(!e||!e._id||!e.mobileNo||e.mobileNo.length<1)return m.success(r,{data:!1,message:"Mobile Number & Email Id entered not matches. Please enter the registered Mobile Number and Email Id. Contact your other registered home member / administrator to register your account."});if(e.mobileNo&&e.mobileNo.length>0){let t=e.mobileNo.length>3?e.mobileNo.substr(e.mobileNo.length-3,3):e.mobileNo;return m.success(r,{data:!1,message:"Mobile Number entered not matches. Mobile Number ends with "+t+" is associated with the Email Id you entered. So you can use that Mobile Number."})}return m.success(r,{data:!1,message:"No valid Mobile Number available for the Email Id you entered. So please contact administartor to update your Mobile Number."})}).catch(e=>m.error(r,e.message||"Some error occurred while retrieving data."))}).catch(e=>m.error(r,e.message||"Some error occurred while retrieving data."))}).catch(e=>m.error(r,e.message||"Some error occurred while retrieving data."))},r.updateProfile=(e,r)=>{if(!e.body.name||!e.body.mobileNo||!e.body.emailId)return m.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";s.findOne({mobileNo:e.body.mobileNo,isActive:!0},{_id:1}).then(i=>{if(e.body.mobileNo&&i&&i._id&&i._id!=e.params.id)return m.cError(r,"User with same mobile number already exists. So please try with different mobile number.");s.findByIdAndUpdate(e.params.id,{name:e.body.name||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",updatedBy:t},{new:!0}).then(t=>t&&t._id?m.success(r,!0):m.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?m.nError(r,"Record not found with id "+e.params.id):m.error(r,"Internal server error. Error updating record with id "+e.params.id))}).catch(t=>m.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.signUp=(e,r)=>{if(!(e.body.clientNumber&&e.body.name&&e.body.age&&e.body.gender&&e.body.mobileNo&&e.body.emailId))return m.vError(r,"Validation failed. Please fill all the required fields.");s.findOne({$and:[{$or:[{mobileNo:e.body.mobileNo}],isActive:!0}]},{_id:1}).then(t=>{if(t&&t._id)return m.cError(r,"User with same mobile number already exists. So please try with different mobile number.");s.find({$and:[{mobileNo:e.body.clientNumber,role:{$regex:"ADMIN",$options:"i"},isActive:!0}]},{_clientId:1}).then(t=>{if(!t||!t._clientId)return m.cError(r,"Invalid Client Number. Please contact administrator/manager to get valid Client Number.");new s({_clientId:t._clientId,number:e.body.number||"",name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",password:e.body.password||"",type:e.body.type||"",role:e.body.role||"",image:e.body.image||"",fcmToken:"",os:"",osVersion:"",isApproved:!1,isActive:!1,createdBy:""}).save().then(e=>e&&e._id?m.success(r,e._id):m.cError(r,"Data not found. Some problem occurs.")).catch(e=>m.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>m.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>m.error(r,e.message||"Some error occurred while creating a record."))}},function(e,r){e.exports=require("shortid")},function(e,r,t){const i=t(5);var d=i.Schema;const o=i.Schema({txnRef:String,txnId:String,amount:Number,status:String,isSuccess:Boolean,reason:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,amount:Number,mode:String,type:String,description:String,forMonth:Number,forYear:Number,transactions:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.models&&i.models.Payment?i.models.Payment:i.model("Payment",n)},function(e,r){e.exports=require("nodemailer")},function(e,r){e.exports={isSend:!0,host:"smtp.gmail.com",port:465,isSecure:!0,userName:"orgnaveen@gmail.com",password:"MyNest@123",from:"nestadmin@gmail.com",to:"nvnkmrmca@gmail.com",cc:""}},function(e,r,t){"use strict";const i=t(1),d=t(30),o="/member";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(2),d=t(9),o=t(0),n=t(3),a=t(4);r.create=(e,r)=>{if(!e.body.name||!e.body.age||!e.body.gender)return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["client-id"]||"",n=e.headers["user-id"]||"";d.findOne({$and:[{$or:[{mobileNo:e.body.mobileNo}],isActive:!0}]},{_id:1}).then(a=>{if(e.body.mobileNo&&a&&a._id)return o.cError(r,"User with same mobile number already exists. So please try with different mobile number.");new d({_clientId:t,number:e.body.number||"",name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",password:e.body.password||"",type:e.body.type||"",role:e.body.role||"",image:e.body.image||"",fcmToken:"",os:"",osVersion:"",isApproved:!0,isActive:!0,createdBy:n}).save().then(t=>t&&t._id?(e.body.isAM?e.body.homeIds&&e.body.homeIds.length>0&&i.updateMany({_id:{$in:e.body.homeIds}},{$push:{members:t._id}},{safe:!0,multi:!0,new:!0}).then(e=>{}).catch(e=>{}):e.params.id&&i.updateOne({_id:e.params.id},{$push:{members:t._id}},{new:!0}).then(e=>{}).catch(e=>{}),o.success(r,t._id)):o.cError(r,"Data not found. Some problem occurs.")).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return o.vError(r,"Validation failed. Please send client id.");d.find({_clientId:t,isActive:!0},{_id:1,name:1}).then(e=>o.success(r,e)).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.findAllByHome=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return o.vError(r,"Validation failed. Please send client id.");i.findById(e.params.id,{_id:1,number:1,members:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.members)return o.cError(r,"Record not found.");d.find({$and:[{_id:{$in:e.members},isActive:!0}]}).then(e=>{if(!e)return o.cError(r,"Record not found.");e=n.clone(e);let t=[];if(e.map((e,r)=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy)}),!(t&&t.length>0))return o.success(r,e);a.getNames(t).then(t=>(t&&t.length>0&&e.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name)}),o.success(r,e))).catch(t=>o.success(r,e))}).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))}).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{d.findById(e.params.id).then(t=>{if(!t)return o.cError(r,"Record not found with id "+e.params.id);i.find({$and:[{members:{$all:[e.params.id]},isActive:!0}]},{_id:1}).then(e=>{let i=[];return e&&e.length>0&&e.map((e,r)=>{i.push(e._id)}),o.success(r,{member:t,homeIds:i})}).catch(e=>o.success(r,{member:t,homeIds:[]}))}).catch(t=>"ObjectId"===t.kind?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Error retrieving record with id "+e.params.id))},r.update=(e,r)=>{if(!e.body.name||!e.body.age||!e.body.gender)return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";d.findOne({mobileNo:e.body.mobileNo,isActive:!0},{_id:1}).then(n=>{if(e.body.mobileNo&&n&&n._id&&n._id!=e.params.id)return o.cError(r,"User with same mobile number already exists. So please try with different mobile number.");d.findByIdAndUpdate(e.params.id,{number:e.body.number||"",name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",password:e.body.password||"",type:e.body.type||"",role:e.body.role||"",updatedBy:t},{new:!0}).then(t=>t&&t._id?(e.body.isAM&&(i.updateMany({members:{$in:[t._id]}},{$pull:{members:[t._id]}},{safe:!0,multi:!0,new:!0}).then(e=>{}).catch(e=>{}),e.body.homeIds&&e.body.homeIds.length>0&&i.updateMany({_id:{$in:e.body.homeIds}},{$push:{members:t._id}},{safe:!0,multi:!0,new:!0}).then(e=>{}).catch(e=>{})),o.success(r,t._id)):o.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Error updating record with id "+e.params.id))}).catch(t=>o.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{let t=e.headers["user-id"]||"";d.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:t||null}).then(t=>t&&t._id?o.success(r,!0,"Record deleted successfully."):o.cError(r,"Could not delete record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>{d.find({$and:[{$or:[{number:new RegExp(e.params.text,"i"),name:new RegExp(e.params.text,"i"),mobileNo:new RegExp(e.params.text,"i"),emailId:new RegExp(e.params.text,"i")}],isActive:!0}]}).then(e=>o.success(r,e)).catch(e=>o.error(r,e.message||"Some error occurred while retrieving records."))}},function(e,r,t){"use strict";const i=t(1),d=t(32),o="/vehicle";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(2),d=t(0),o=t(3),n=t(4);r.create=(e,r)=>{if(!e.body.number||!e.body.type)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{vehicles:{number:e.body.number||"",type:e.body.type||"",image:e.body.image||"",isActive:!0,createdBy:t}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return d.cError(r,"Failed to create record.");i.findById(e.params.id,{vehicles:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.vehicles||e.vehicles.length<1?d.cError(r,"Failed to create record."):d.success(r,e.vehicles[e.vehicles.length-1]._id)).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return d.vError(r,"Validation failed. Please send client id.");i.find({_clientId:t,isActive:!0},{number:1,vehicles:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||e.length<1)return d.cError(r,[]);let t=[];e.map((e,r)=>{let i=e.vehicles;i&&i.length>0&&((i=o.clone(i)).forEach(r=>{r._homeId=e.number}),t=t.concat(i))});let i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(r,t);n.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),d.success(r,t))).catch(e=>d.success(r,t))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findAllByHome=(e,r)=>{i.findById(e.params.id,{number:1,vehicles:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.vehicles)return d.cError(r,"Record not found.");let t=o.clone(e.vehicles);t.forEach(r=>{r._homeId=e.number});let i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(r,t);n.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),d.success(r,t))).catch(e=>d.success(r,t))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findOne({"vehicles._id":e.params.id},{vehicles:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.vehicles?(t=t.vehicles.filter((r,t)=>r._id==e.params.id),d.success(r,t&&t.length>0?t[0]:null)):d.cError(r,"Record not found.")).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>{if(!e.body.number||!e.body.type)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOneAndUpdate({"vehicles._id":e.params.id},{$set:{"vehicles.$.number":e.body.number||"","vehicles.$.type":e.body.type||"","vehicles.$.updatedBy":t||null}},{projection:{_id:1}}).then(t=>t&&t._id?d.success(r,e.params.id):d.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{i.update({"vehicles._id":e.params.id},{$pull:{vehicles:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?d.cError(r,"Could not delete record with id "+e.params.id):d.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>d.cError(r,"Not implemented.")},function(e,r,t){"use strict";const i=t(1),d=t(34),o="/servent";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(2),d=t(0),o=t(3),n=t(4);r.create=(e,r)=>{if(!e.body.name||!e.body.age||!e.body.gender)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{servents:{name:e.body.name||"",age:e.body.age||0,gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",image:e.body.image||"",isActive:!0,createdBy:t}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return d.cError(r,"Failed to create record.");i.findById(e.params.id,{servents:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.servents||e.servents.length<1?d.cError(r,"Failed to create record."):d.success(r,e.servents[e.servents.length-1]._id)).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return d.vError(r,"Validation failed. Please send client id.");i.find({_clientId:t,isActive:!0},{number:1,servents:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||e.length<1)return d.cError(r,[]);let t=[];e.map((e,r)=>{let i=e.servents;i&&i.length>0&&((i=o.clone(i)).forEach(r=>{r._homeId=e.number}),t=t.concat(i))});let i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(r,t);n.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),d.success(r,t))).catch(e=>d.success(r,t))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findAllByHome=(e,r)=>{i.findById(e.params.id,{number:1,servents:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.servents)return d.cError(r,"Record not found.");let t=o.clone(e.servents);t.forEach(r=>{r._homeId=e.number});let i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(r,t);n.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),d.success(r,t))).catch(e=>d.success(r,t))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findOne({"servents._id":e.params.id},{servents:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.servents?(t=t.servents.filter((r,t)=>r._id==e.params.id),d.success(r,t&&t.length>0?t[0]:null)):d.cError(r,"Record not found.")).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>{if(!e.body.name||!e.body.age||!e.body.gender)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOneAndUpdate({"servents._id":e.params.id},{$set:{"servents.$.name":e.body.name||"","servents.$.age":e.body.age||0,"servents.$.gender":e.body.gender||"","servents.$.mobileNo":e.body.mobileNo||"","servents.$.emailId":e.body.emailId||"","servents.$.updatedBy":t||null}},{projection:{_id:1}}).then(t=>t&&t._id?d.success(r,e.params.id):d.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{i.update({"servents._id":e.params.id},{$pull:{servents:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?d.cError(r,"Could not delete record with id "+e.params.id):d.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>d.cError(r,"Not implemented.")},function(e,r,t){"use strict";const i=t(1),d=t(36),o="/ticket";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.delete(o+"/resolve/:id",i.checkToken,d.resolve),e.put(o+"/start/:id",i.checkToken,d.start),e.post(o+"/comment/:id",i.checkToken,d.addComment),e.put(o+"/comment/:id",i.checkToken,d.updateComment),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(37),d=t(2),o=t(3),n=t(0),a=t(7),s=t(8),c=t(4),l=t(10);r.create=(e,r)=>{if(!e.body.title||!e.body.status||!e.params.id)return n.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"",d=e.headers["client-id"]||"";new i({_clientId:d,_homeId:e.params.id,title:e.body.title,description:e.body.description,status:e.body.status,comments:[],isActive:!0,createdBy:t}).save().then(i=>i&&i._id?(m(!0,e.params.id,i.title,i.description,i.status,d,t),n.success(r,i._id)):n.cError(r,"Data not found. Some problem occurs.")).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return n.vError(r,"Validation failed. Please send client id.");d.find({_clientId:t,isActive:!0},{_id:1}).then(e=>{if(!e||e.length<1)return n.cError(r,[]);let d=[];e.map((e,r)=>{d.push(e._id)}),i.find({_clientId:t,_homeId:{$in:d},isActive:!0},{_id:1,_homeId:1,title:1,description:1,status:1,comments:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1}).then(e=>{if(!(e&&e.length>0))return n.success(r,[]);{e=o.clone(e);let t=[],i=[];if(e.forEach(e=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.comments&&e.comments.length>0&&(e.comments=e.comments.reverse(),e.comments.map((e,r)=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy)}))}),!(i&&i.length>0))return n.success(r,e);l.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let r=i.filter(r=>r._id.toString()==e._homeId);r&&r.length>0&&r[0]._id&&(e._homeId=r[0].number)}),!(t&&t.length>0))return n.success(r,e);c.getNames(t).then(t=>(t&&t.length>0&&e.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name),e.comments.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name)})}),n.success(r,e))).catch(t=>n.success(r,e))}).catch(t=>n.success(r,e))}}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))},r.findAllByHome=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return n.vError(r,"Validation failed. Please send client id.");i.find({_clientId:t,_homeId:e.params.id,isActive:!0},{_id:1,_homeId:1,title:1,description:1,status:1,comments:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1}).then(e=>{if(!(e&&e.length>0))return n.success(r,[]);{e=o.clone(e);let t=[],i=[];if(e.forEach(e=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.comments&&e.comments.length>0&&(e.comments=e.comments.reverse(),e.comments.map((e,r)=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy)}))}),!(i&&i.length>0))return n.success(r,e);l.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let r=i.filter(r=>r._id.toString()==e._homeId);r&&r.length>0&&r[0]._id&&(e._homeId=r[0].number)}),!(t&&t.length>0))return n.success(r,e);c.getNames(t).then(t=>(t&&t.length>0&&e.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name),e.comments.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name)})}),n.success(r,e))).catch(t=>n.success(r,e))}).catch(t=>n.success(r,e))}}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findById(e.params.id).then(t=>t?n.success(r,t):n.cError(r,"Record not found with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Error retrieving record with id "+e.params.id))},r.update=(e,r)=>{if(!e.body.title||!e.body.status||!e.params.id)return n.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{title:e.body.title,description:e.body.description,status:e.body.status,updatedBy:d},{new:!0}).then(i=>i&&i._id?(m(!1,e.body.homeId,i.title,i.description,i.status,t,d),n.success(r,i._id)):n.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:d||null},{new:!0}).then(i=>i&&i._id?(h(i._homeId,i.title,i.description,i.status,t,d),n.success(r,!0,"Record deleted successfully.")):n.cError(r,"Could not delete record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.resolve=(e,r)=>{let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{status:"RESOLVED",isActive:!1,updatedBy:d||null},{new:!0}).then(i=>i&&i._id?(u(i._homeId,i.title,i.description,i.status,t,d),n.success(r,!0,"Ticket resolved successfully.")):n.cError(r,"Could not resolve the ticket with id "+e.params.id)).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.start=(e,r)=>{let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{status:e.body.status,updatedBy:d||null},{new:!0}).then(i=>i&&i._id?(p(i._homeId,i.title,i.description,i.status,t,d,i.createdBy),n.success(r,!0,"Ticket started successfully.")):n.cError(r,"Could not start the ticket with id "+e.params.id)).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.addComment=(e,r)=>{let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{comments:{comment:e.body.comment||"",isActive:!0,createdBy:d||null}}},{new:!0}).then(o=>{if(!o||!o.ok||o.ok<1)return n.cError(r,"Failed to add comment.");i.findById(e.params.id,{_homeId:1,title:1,description:1,status:1,comments:[{$elemMatch:{isActive:!0}}]}).then(i=>!i||!i.comments||i.comments.length<1?n.cError(r,"Failed to add comment."):(i.comments[i.comments.length-1].createdBy.toString()==d?f(!0,i._homeId,i.title,i.description,i.status,e.body.comment,t,d):y(!0,i._homeId,i.title,i.description,i.status,e.body.comment,t,d),n.success(r,i.comments[i.comments.length-1]._id))).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))},r.updateComment=(e,r)=>{let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findOneAndUpdate({"comments._id":e.params.id},{$set:{"comments.$.comment":e.body.comment||"","comments.$.updatedBy":d||null}}).then(o=>{if(!o||!o.ok||o.ok<1)return n.cError(r,"Failed to add comment.");i.findOne({"comments._id":e.params.id}).then(i=>!i||!i.comments||i.comments.length<1?n.cError(r,"Failed to add comment."):(i.comments[i.comments.length-1].createdBy.toString()==d?f(!1,i._homeId,i.title,i.description,i.status,e.body.comment,t,d):y(!1,i._homeId,i.title,i.description,i.status,e.body.comment,t,d),n.success(r,e.params.id))).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))},r.search=(e,r)=>n.cError(r,"Not implemented.");const m=(e,r,t,i,d,o,n)=>{c.getAMMailANDFCM(o).then(o=>{c.getName(n).then(n=>{l.getNumber(r).then(r=>{let c="<html><body>";c+='<div style="width: 100%; margin: 15px;">',c+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+(e?"New Ticket raised":"Ticket updated")+"</div>",c+='<div style="width: 100%;">',c+='<div style="width: 100%; margin: 5px 0px;">Home: '+r+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">'+(e?"Raised By: ":"Updated By: ")+n+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Title: '+t+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Description: '+i+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Status: '+d+"</div>",c+="</div></body></html>",a.send((e?"New Ticket raised by ":"Ticket updated by ")+n,c,o.mailIds,!0),s.send((e?"New Ticket raised by ":"Ticket updated by ")+n+" from "+r,t+": "+i,o.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},h=(e,r,t,i,d,o)=>{c.getAMMailANDFCM(d).then(d=>{c.getName(o).then(o=>{l.getNumber(e).then(e=>{let n="<html><body>";n+='<div style="width: 100%; margin: 15px;">',n+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+o+" removed the ticket.</div>",n+='<div style="width: 100%;">',n+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Title: '+r+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Description: '+t+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Status: '+i+"</div>",n+="</div></body></html>",a.send(o+" removed the ticket from "+e+".",n,d.mailIds,!0),s.send(o+" removed the ticket from "+e+".",r+": "+t,d.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},u=(e,r,t,i,d,o)=>{c.getAMMailANDFCM(d).then(d=>{c.getName(o).then(o=>{l.getNumber(e).then(e=>{let n="<html><body>";n+='<div style="width: 100%; margin: 15px;">',n+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+o+" resolved the ticket.</div>",n+='<div style="width: 100%;">',n+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Title: '+r+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Description: '+t+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Status: '+i+"</div>",n+="</div></body></html>",a.send(o+" resolved the ticket from "+e+".",n,d.mailIds,!0),s.send(o+" resolved the ticket from "+e+".",r+": "+t,d.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},p=(e,r,t,i,d,o,n)=>{c.getMailANDFCM(n).then(d=>{c.getName(o).then(o=>{l.getNumber(e).then(e=>{let n="<html><body>";n+='<div style="width: 100%; margin: 15px;">',n+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+o+" started the ticket.</div>",n+='<div style="width: 100%;">',n+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Title: '+r+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Description: '+t+"</div>",n+='<div style="width: 100%; margin: 5px 0px;">Status: '+i+"</div>",n+="</div></body></html>",a.send(o+" started the ticket for "+e+".",n,d.mailId,!0),s.send(o+" started the ticket for "+e+".",r+": "+t,[d.fcmToken])}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},f=(e,r,t,i,d,o,n,m)=>{c.getAMMailANDFCM(n).then(n=>{c.getName(m).then(c=>{l.getNumber(r).then(r=>{let l="<html><body>";l+='<div style="width: 100%; margin: 15px;">',l+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+c+(e?" commented on Ticket.":" updated the comment for the Ticket.")+"</div>",l+='<div style="width: 100%;">',l+='<div style="width: 100%; margin: 5px 0px;">Home: '+r+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Title: '+t+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Description: '+i+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Status: '+d+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Comment: '+o+"</div>",l+="</div></body></html>",a.send(c+" from "+r+(e?" commented on the ticket.":" updated the comment for the ticket."),l,n.mailIds,!0),s.send(c+" from "+r+(e?" commented on the ticket":" updated the comment for the ticket"),t+": "+o,n.fcmTokens)}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})},y=(e,r,t,i,d,o,n,m)=>{c.getMailANDFCM(m).then(n=>{c.getName(m).then(c=>{l.getNumber(r).then(r=>{let l="<html><body>";l+='<div style="width: 100%; margin: 15px;">',l+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+c+(e?" commented on Ticket.":" updated the comment for the Ticket.")+"</div>",l+='<div style="width: 100%;">',l+='<div style="width: 100%; margin: 5px 0px;">Home: '+r+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Title: '+t+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Description: '+i+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Status: '+d+"</div>",l+='<div style="width: 100%; margin: 5px 0px;">Comment: '+o+"</div>",l+="</div></body></html>",a.send(c+(e?" commented on Ticket.":" updated the comment for the ticket."),l,n.mailId,!0),s.send(c+(e?" commented on the ticket":" updated the comment for the ticket"),t+": "+o,[n.fcmToken])}).catch(e=>{})}).catch(e=>{})}).catch(e=>{})}},function(e,r,t){const i=t(5);var d=i.Schema;const o=i.Schema({comment:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,title:String,description:String,status:String,comments:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Ticket",n)},function(e,r){e.exports=require("fcm-node")},function(e,r){e.exports={isSend:!0,url:"https://fcm.googleapis.com/fcm/send",serverKey:"AIzaSyCXk69hIGKXfWtBxruGjFYOEI4Soxj5UhE",senderId:"422026408390"}},function(e,r,t){"use strict";const i=t(1),d=t(41),o="/payment";e.exports=e=>{e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.post(o+"s/:id",i.checkToken,d.search),e.post(o+"/:id",i.checkToken,d.create),e.put(o+"/:id",i.checkToken,d.update),e.post(o+"/transaction/:id",i.checkToken,d.createTransaction)}},function(e,r,t){"use strict";const i=t(42),d=t(2),o=t(3),n=t(0),a=t(4),s=t(10);r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return n.vError(r,"Validation failed. Please send client id.");d.find({_clientId:t,isActive:!0},{_id:1}).then(e=>{if(!e||e.length<1)return n.cError(r,[]);let d=[];e.map((e,r)=>{d.push(e._id)}),i.find({_clientId:t,_homeId:{$in:d},isActive:!0},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(e=>{if(!(e&&e.length>0))return n.success(r,[]);{e=o.clone(e);let t=[],i=[];if(e.forEach(e=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse(),e.transactions.map((e,r)=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy)}))}),!(i&&i.length>0))return n.success(r,e);s.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let r=i.filter(r=>r._id.toString()==e._homeId);r&&r.length>0&&r[0]._id&&(e._homeId=r[0].number)}),!(t&&t.length>0))return n.success(r,e);a.getNames(t).then(t=>(t&&t.length>0&&e.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name),e.transactions.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name)})}),n.success(r,e))).catch(t=>n.success(r,e))}).catch(t=>n.success(r,e))}}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))},r.findAllByHome=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return n.vError(r,"Validation failed. Please send client id.");i.find({_clientId:t,_homeId:e.params.id,isActive:!0},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(e=>{if(!(e&&e.length>0))return n.success(r,[]);{e=o.clone(e);let t=[],i=[];if(e.forEach(e=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse(),e.transactions.map((e,r)=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy)}))}),!(i&&i.length>0))return n.success(r,e);s.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let r=i.filter(r=>r._id.toString()==e._homeId);r&&r.length>0&&r[0]._id&&(e._homeId=r[0].number)}),!(t&&t.length>0))return n.success(r,e);a.getNames(t).then(t=>(t&&t.length>0&&e.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name),e.transactions.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name)})}),n.success(r,e))).catch(t=>n.success(r,e))}).catch(t=>n.success(r,e))}}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))},r.create=(e,r)=>{if(!(e.params.id&&e.body.amount&&e.body.month>=0&&e.body.year&&(e.body.isAllHome||e.body.homes)))return n.vError(r,"Validation failed. Please fill all the required fields.");let t=e.params.id,o=e.headers["user-id"]||"";i.find({_clientId:t,forMonth:e.body.month,forYear:e.body.year},{_id:1,_homeId:1}).then(a=>{(!a||a.length<1)&&(a=[]),d.find({_clientId:t,isActive:!0},{_id:1}).then(d=>{if(!d||d.length<1)return n.cError(r,"No home found to create payment.");if(!(d.length>a.length))return n.cError(r,"Payment is already created for all homes. If you want to edit, Please go to payment history then serach and edit.");{e.body.isAllHome||(d=d.filter((r,t)=>e.body.homes.indexOf(r._id.toString())>=0)),a&&a.length>0&&(d=d.filter((e,r)=>a.filter((r,t)=>r._homeId.toString()==e._id.toString()).length<1));let s=[];if(d.map((r,d)=>{s.push(new i({_clientId:t,_homeId:r._id,amount:e.body.amount||0,mode:e.body.mode||"",type:e.body.type||"",description:e.body.description||"",forMonth:e.body.month,forYear:e.body.year,transactions:[],isActive:!0,createdBy:o}))}),!(s&&s.length>0))return n.error(r,"Payment for the month you selected is already created for all homes. If you want to edit please secect home number(s) insted of All Homes.");i.insertMany(s).then(e=>!e||e.length<1?n.cError(r,"Failed to create payment."):n.success(r,!0,"Payment created successfully.")).catch(e=>n.error(r,e.message||"Some error occurred while creating payment."))}}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))}).catch(e=>n.error(r,e.message||"Some error occurred while validating payment."))},r.update=(e,r)=>{if(!e.params.id||!e.body.amount)return n.vError(r,"Validation failed. Please fill all the required fields.");e.params.id;let t=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{amount:e.body.amount,description:e.body.description||"",updatedBy:t},{new:!0}).then(t=>t&&t._id?n.success(r,!0,"Payment updated successfully."):n.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?n.nError(r,"Record not found with id "+e.params.id):n.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.createTransaction=(e,r)=>{if(!e.body.txnRef||!e.body.amount||!e.body.status)return n.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{transactions:{txnRef:e.body.txnRef||"",txnId:e.body.txnId||"",amount:e.body.amount||0,status:e.body.status||"",isSuccess:e.body.isSuccess||!1,reason:e.body.reason||"",isActive:!0,createdBy:t}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return n.cError(r,"Failed to create record.");i.findById(e.params.id,{transactions:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.transactions||e.transactions.length<1?n.cError(r,"Failed to create record."):n.success(r,e.transactions[e.transactions.length-1]._id)).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>n.error(r,e.message||"Some error occurred while creating a record."))},r.search=(e,r)=>{if(!e.params.id||e.params.id.length<1||!e.body.fromDate||!e.body.toDate)return n.vError(r,"Validation failed. Please fill all the required fields.");let t=e.params.id;d.find({_clientId:t,isActive:!0},{_id:1}).then(d=>{if(!d||d.length<1)return n.cError(r,[]);let c=[];e.body.homes&&e.body.homes.length>0?c=e.body.homes:d.map((e,r)=>{c.push(e._id)});let l=new Date(e.body.fromDate);l.setDate(l.getDate()-1);let m=new Date(e.body.toDate);m.setDate(m.getDate()+1),i.find({_clientId:t,_homeId:{$in:c},createdAt:{$gte:l,$lt:m},isActive:!0},{_id:1,_homeId:1,amount:1,mode:1,type:1,description:1,forMonth:1,forYear:1,transactions:[{$elemMatch:{isActive:!0}}],createdBy:1,updatedBy:1,createdAt:1},{$orderby:{createdAt:-1}}).then(e=>{if(!(e&&e.length>0))return n.success(r,[]);{e=o.clone(e);let t=[],i=[];if(e.forEach(e=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy),i.indexOf(e._homeId.toString())<0&&i.push(e._homeId),e.transactions&&e.transactions.length>0&&(e.transactions=e.transactions.reverse(),e.transactions.map((e,r)=>{e.createdBy&&t.indexOf(e.createdBy.toString())<0&&t.push(e.createdBy)}))}),!(i&&i.length>0))return n.success(r,e);s.getNumbers(i).then(i=>{if(i&&i.length>0&&e.forEach(e=>{let r=i.filter(r=>r._id.toString()==e._homeId);r&&r.length>0&&r[0]._id&&(e._homeId=r[0].number)}),!(t&&t.length>0))return n.success(r,e);a.getNames(t).then(t=>(t&&t.length>0&&e.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name),e.transactions.forEach(e=>{let r=t.filter(r=>r._id.toString()==e.createdBy);r&&r.length>0&&r[0]._id&&(e.createdBy=r[0].name)})}),n.success(r,e))).catch(t=>n.success(r,e))}).catch(t=>n.success(r,e))}}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))}).catch(e=>n.error(r,e.message||"Some error occurred while retrieving data."))}},function(e,r,t){const i=t(5);var d=i.Schema;const o=i.Schema({txnRef:String,txnId:String,amount:Number,status:String,isSuccess:Boolean,reason:String,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({_clientId:d.Types.ObjectId,_homeId:d.Types.ObjectId,amount:Number,mode:String,type:String,description:String,forMonth:Number,forYear:Number,transactions:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.models&&i.models.Payment?i.models.Payment:i.model("Payment",n)},function(e,r,t){"use strict";const i=t(1),d=t(44);e.exports=e=>{e.post("/ad/:id",i.checkToken,d.create),e.get("/ads/:id",i.checkToken,d.findAll),e.get("/ad/:id",i.checkToken,d.findOne),e.put("/ad/:id",i.checkToken,d.update),e.delete("/ad/:id",i.checkToken,d.delete),e.get("/ad/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(6),d=t(3),o=t(0),n=t(4);r.create=(e,r)=>{if(!e.body.title||!e.body.description)return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{ads:{title:e.body.title||"",description:e.body.description||"",isActive:!0,createdBy:t}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return o.cError(r,"Failed to create record.");i.findById(e.params.id,{ads:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.ads||e.ads.length<1?o.cError(r,"Failed to create record."):o.success(r,e.ads[e.ads.length-1]._id)).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{i.findById(e.params.id,{ads:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.ads)return o.cError(r,"Record not found.");let t=d.clone(e.ads),i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(r,t);n.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),o.success(r,t))).catch(e=>o.success(r,t))}).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findById({"ads._id":e.params.id},{ads:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.ads?(t=t.ads.filter((r,t)=>r._id==e.params.id),o.success(r,t&&t.length>0?t[0]:null)):o.cError(r,"Record not found.")).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>{if(!e.body.title||!e.body.description)return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOneAndUpdate({"ads._id":e.params.id},{$set:{"ads.$.title":e.body.title||"","ads.$.description":e.body.description||"","ads.$.updatedBy":t||null}},{projection:{_id:1}}).then(t=>t&&t._id?o.success(r,e.params.id):o.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{i.update({"ads._id":e.params.id},{$pull:{ads:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?o.cError(r,"Could not delete record with id "+e.params.id):o.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>o.cError(r,"Not implemented.")},function(e,r,t){"use strict";const i=t(1),d=t(46),o="/document";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(2),d=t(3),o=t(0),n=t(4);r.create=(e,r)=>{if(!e.body.title||!e.body.description)return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{documents:{title:e.body.title||"",description:e.body.description||"",file:e.body.file||"",isActive:!0,createdBy:t}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return o.cError(r,"Failed to create record.");i.findById(e.params.id,{documents:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.documents||e.documents.length<1?o.cError(r,"Failed to create record."):o.success(r,e.documents[e.documents.length-1]._id)).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{i.findById(e.params.id,{documents:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.documents)return o.cError(r,"Record not found.");let t=d.clone(e.documents),i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(r,t);n.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),o.success(r,t))).catch(e=>o.success(r,t))}).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findOne({"documents._id":e.params.id},{documents:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.documents?(t=t.documents.filter((r,t)=>r._id==e.params.id),o.success(r,t&&t.length>0?t[0]:null)):o.cError(r,"Record not found.")).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>{if(!e.body.title||!e.body.description)return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOneAndUpdate({"documents._id":e.params.id},{$set:{"documents.$.title":e.body.title||"","documents.$.description":e.body.description||"","documents.$.file":e.body.file||"","documents.$.updatedBy":t||null}},{projection:{_id:1}}).then(t=>t&&t._id?o.success(r,e.params.id):o.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{i.update({"documents._id":e.params.id},{$pull:{documents:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?o.cError(r,"Could not delete record with id "+e.params.id):o.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>o.cError(r,"Not implemented.")},function(e,r,t){"use strict";const i=t(1),d=t(48),o="/notification";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s/:id",i.checkToken,d.findAll),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(6),d=t(3),o=t(0),n=t(4),a=t(8);r.create=(e,r)=>{if(!e.body.title||!e.body.body)return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{notifications:{title:e.body.title||"",body:e.body.body||"",isActive:!0,createdBy:d}}},{new:!0}).then(d=>{if(!d||!d.ok||d.ok<1)return o.cError(r,"Failed to create record.");i.findById(e.params.id,{notifications:[{$elemMatch:{isActive:!0}}]}).then(i=>!i||!i.notifications||i.notifications.length<1?o.cError(r,"Failed to create record."):(s(e.body.title,e.body.body,t),o.success(r,i.notifications[i.notifications.length-1]._id))).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{i.findById(e.params.id,{notifications:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.notifications)return o.cError(r,"Record not found.");let t=d.clone(e.notifications);t=t.reverse();let i=[];if(t.map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(r,t);n.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),o.success(r,t))).catch(e=>o.success(r,t))}).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findOne({"notifications._id":e.params.id},{notifications:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.notifications?(t=t.notifications.filter((r,t)=>r._id==e.params.id),o.success(r,t&&t.length>0?t[0]:null)):o.cError(r,"Record not found.")).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>o.cError(r,"Not implemented."),r.delete=(e,r)=>{i.update({"notifications._id":e.params.id},{$pull:{notifications:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?o.cError(r,"Could not delete record with id "+e.params.id):o.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>o.cError(r,"Not implemented.");const s=(e,r,t)=>{n.getAllFCM(t).then(t=>{a.send(e,r,t)}).catch(e=>{})}},function(e,r,t){"use strict";const i=t(1),d=t(50),o="/outing";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.delete(o+"/return/:id",i.checkToken,d.return),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(2),d=t(3),o=t(0),n=t(7),a=t(8),s=t(4);r.create=(e,r)=>{if(!(e.body.fromDate&&e.body.toDate&&e.body.place&&e.body.address))return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{outings:{fromDate:e.body.fromDate?new Date(e.body.fromDate):null,toDate:e.body.toDate?new Date(e.body.toDate):null,place:e.body.place||"",address:e.body.address||"",isReturned:!1,returnedAt:null,isActive:!0,createdBy:d}}},{new:!0}).then(n=>{if(!n||!n.ok||n.ok<1)return o.cError(r,"Failed to create record.");i.findById(e.params.id,{number:1,outings:[{$elemMatch:{isActive:!0}}]}).then(i=>!i||!i.outings||i.outings.length<1?o.cError(r,"Failed to create record."):(c(i.number,e.body.fromDate||"",e.body.toDate||"",e.body.place||"",e.body.address||"",t,d),o.success(r,i.outings[i.outings.length-1]._id))).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>o.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return o.vError(r,"Validation failed. Please send client id.");i.find({_clientId:t,isActive:!0},{number:1,outings:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||e.length<1)return o.cError(r,[]);let t=[];e.map((e,r)=>{let i=e.outings.filter((e,r)=>1!=e.isReturned);i&&i.length>0&&((i=d.clone(i)).forEach(r=>{r._homeId=e.number}),t=t.concat(i))});let i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(r,t);s.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),o.success(r,t))).catch(e=>o.success(r,t))}).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.findAllByHome=(e,r)=>{i.findById(e.params.id,{number:1,outings:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.outings)return o.cError(r,"Record not found.");let t=d.clone(e.outings),i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return o.success(r,t);s.getNames(i).then(i=>(i&&i.length>0&&t.forEach(r=>{r._homeId=e.number;let t=i.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),o.success(r,t))).catch(e=>o.success(r,t))}).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findOne({"outings._id":e.params.id},{outings:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.outings?(t=t.outings.filter((r,t)=>r._id==e.params.id),o.success(r,t&&t.length>0?t[0]:null)):o.cError(r,"Record not found.")).catch(e=>o.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>{if(!(e.body.fromDate&&e.body.toDate&&e.body.place&&e.body.address))return o.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOneAndUpdate({"outings._id":e.params.id},{$set:{"outings.$.fromDate":e.body.fromDate?new Date(e.body.fromDate):null,"outings.$.toDate":e.body.toDate?new Date(e.body.toDate):null,"outings.$.place":e.body.place||"","outings.$.address":e.body.address||"","outings.$.updatedBy":t||null}},{projection:{_id:1}}).then(t=>t&&t._id?o.success(r,e.params.id):o.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{i.update({"outings._id":e.params.id},{$pull:{outings:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?o.cError(r,"Could not delete record with id "+e.params.id):o.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.return=(e,r)=>{let t=e.headers["client-id"]||"",d=e.headers["user-id"]||"";i.findOneAndUpdate({"outings._id":e.params.id},{$set:{"outings.$.isReturned":!0,"outings.$.returnedAt":new Date,"outings.$.updatedBy":d||null}},{projection:{_id:1,number:1,outings:[{$elemMatch:{isActive:!0}}]}}).then(i=>{if(!i||!i._id)return o.cError(r,"Error updating record with id "+e.params.id);let n=i.outing.filter((r,t)=>r._id==e.params.id);return n&&n.length>0&&(n=n[0],l(i.number,n.fromDate,n.toDate,n.place,outerHeight.address,t,d)),o.success(r,e.params.id)}).catch(t=>"ObjectId"===t.kind?o.nError(r,"Record not found with id "+e.params.id):o.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.search=(e,r)=>o.cError(r,"Not implemented.");const c=(e,r,t,i,d,o,c)=>{s.getAMGMailANDFCM(o).then(o=>{s.getName(c).then(s=>{let c="<html><body>";c+='<div style="width: 100%; margin: 15px;">',c+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+s+" and family in "+e+" going for Outing to "+i+".</div>",c+='<div style="width: 100%;">',c+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">From: '+r+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">To: '+t+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Place: '+i+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Address: '+d+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">You will get notification when they return back.</div>',c+="</div></body></html>",n.send(s+" and family in "+e+" going for Outing to "+i+".",c,o.mailIds,!0),a.send(e+" going for Outing",s+" and family in "+e+" going for Outing to "+i+".",o.fcmTokens)}).catch(e=>{})}).catch(e=>{})},l=(e,r,t,i,d,o,c)=>{s.getAMGMailANDFCM(o).then(o=>{s.getName(c).then(s=>{let c="<html><body>";c+='<div style="width: 100%; margin: 15px;">',c+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">'+s+" and family returned from Outing in "+e+".</div>",c+='<div style="width: 100%;">',c+='<div style="width: 100%; margin: 5px 0px;">Home: '+e+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">From: '+r+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">To: '+t+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Place: '+i+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Address: '+d+"</div>",c+='<div style="width: 100%; margin: 5px 0px;">Return On: '+new Date+"</div>",c+="</div></body></html>",n.send(s+" and family returned from Outing in "+e+".",c,o.mailIds,!0),a.send("Returned from Outing in "+e,s+" and family returned from Outing in "+e+".",o.fcmTokens)}).catch(e=>{})}).catch(e=>{})}},function(e,r,t){"use strict";const i=t(1),d=t(52);e.exports=e=>{e.post("/poll/:id",i.checkToken,d.create),e.get("/polls/:id",i.checkToken,d.findAll),e.get("/poll/:id",i.checkToken,d.findOne),e.put("/poll/:id",i.checkToken,d.update),e.delete("/poll/:id",i.checkToken,d.delete),e.post("/poll/vote/:id",i.checkToken,d.vote),e.get("/poll/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(53),d=t(0);t(7),t(8),t(4),t(10);r.create=(e,r)=>{if(!(e.body.topic&&e.body.description&&e.body.fromDate&&e.body.toDate&&e.body.options))return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";e.headers["client-id"];new i({_clientId:e.params.id,topic:e.body.topic||"",description:e.body.description||"",isAllowMultiple:e.body.isAllowMultiple||!1,isOneVotePerFlat:e.body.isOneVotePerFlat||!1,isAnonymous:e.body.isAnonymous||!1,fromDate:e.body.fromDate?new Date(e.body.fromDate):null,toDate:e.body.toDate?new Date(e.body.toDate):null,options:e.body.options||null,votes:[],isActive:!0,createdBy:t}).save().then(e=>e&&e._id?d.success(r,e._id):d.cError(r,"Data not found. Some problem occurs.")).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{if(!e.params.id)return d.vError(r,"Validation failed. Please send client id.");i.find({_clientId:e.params.id,isActive:!0}).then(e=>d.success(r,e)).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findById(e.params.id).then(t=>t?d.success(r,t):d.cError(r,"Record not found with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Error retrieving record with id "+e.params.id))},r.update=(e,r)=>{if(!(e.body.topic&&e.body.description&&e.body.fromDate&&e.body.toDate&&e.body.options))return d.vError(r,"Validation failed. Please fill all the required fields.");e.headers["client-id"];let t=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{topic:e.body.topic||"",description:e.body.description||"",isAllowMultiple:e.body.isAllowMultiple||!1,isOneVotePerFlat:e.body.isOneVotePerFlat||!1,isAnonymous:e.body.isAnonymous||!1,fromDate:e.body.fromDate?new Date(e.body.fromDate):null,toDate:e.body.toDate?new Date(e.body.toDate):null,options:e.body.options||null,updatedBy:t},{new:!0}).then(t=>t&&t._id?d.success(r,t._id):d.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.delete=(e,r)=>{e.headers["client-id"];let t=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:t||null},{new:!0}).then(t=>t&&t._id?d.success(r,!0,"Record deleted successfully."):d.cError(r,"Could not delete record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.vote=(e,r)=>{if(!e.params.id||!e.body.votes||e.body.votes.length<1)return d.vError(r,"Validation failed. Please fill all the required fields.");e.headers["client-id"],e.headers["user-id"];i.updateOne({_id:e.params.id},{$push:{votes:{$each:e.body.votes}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return d.cError(r,"Failed to add vote.");i.findById(e.params.id,{votes:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.votes||e.votes.length<1?d.cError(r,"Failed to add vote."):d.success(r,e.votes)).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))},r.search=(e,r)=>d.cError(r,"Not implemented.")},function(e,r,t){const i=t(5);var d=i.Schema;const o=i.Schema({_homeId:d.Types.ObjectId,_memberId:d.Types.ObjectId,option:Number,isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0}),n=i.Schema({_clientId:d.Types.ObjectId,topic:String,description:String,isAllowMultiple:Boolean,isOneVotePerFlat:Boolean,isAnonymous:Boolean,fromDate:Date,toDate:Date,options:[String],votes:[o],isActive:Boolean,createdBy:{type:d.Types.ObjectId,default:null},updatedBy:{type:d.Types.ObjectId,default:null}},{timestamps:!0});e.exports=i.model("Poll",n)},function(e,r,t){"use strict";const i=t(1),d=t(55),o="/visitor";e.exports=e=>{e.post(o+"/:id",i.checkToken,d.create),e.get(o+"s",i.checkToken,d.findAll),e.get(o+"s/:id",i.checkToken,d.findAllByHome),e.get(o+"/:id",i.checkToken,d.findOne),e.put(o+"/:id",i.checkToken,d.update),e.delete(o+"/:id",i.checkToken,d.delete),e.delete(o+"/exit/:id",i.checkToken,d.exit),e.get(o+"/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(2),d=t(0),o=t(3),n=t(7),a=t(8),s=t(4);r.create=(e,r)=>{if(!e.body.name)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.updateOne({_id:e.params.id},{$push:{visitors:{name:e.body.name||"",age:e.body.age||"",gender:e.body.gender||"",mobileNo:e.body.mobileNo||"",emailId:e.body.emailId||"",image:e.body.image||"",isActive:!0,createdBy:t}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return d.cError(r,"Failed to create record.");i.findById(e.params.id,{number:1,members:1,visitors:[{$elemMatch:{isActive:!0}}]}).then(t=>!t||!t.visitors||t.visitors.length<1?d.cError(r,"Failed to create record."):(c(t.number,e.body.name,e.body.age,e.body.gender,e.body.mobileNo,e.body.emailId,e.body.image,t.members),d.success(r,t.visitors[t.visitors.length-1]._id))).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return d.vError(r,"Validation failed. Please send client id.");i.find({_clientId:t,isActive:!0},{number:1,visitors:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||e.length<1)return d.cError(r,[]);let t=[];e.map((e,r)=>{let i=e.visitors;i&&i.length>0&&((i=o.clone(i)).forEach(r=>{r._homeId=e.number}),t=t.concat(i))});let i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(r,t);s.getNames(i).then(e=>(e&&e.length>0&&t.forEach(r=>{let t=e.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),d.success(r,t))).catch(e=>d.success(r,t))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findAllByHome=(e,r)=>{i.findById(e.params.id,{number:1,visitors:[{$elemMatch:{isActive:!0}}]}).then(e=>{if(!e||!e.visitors)return d.cError(r,"Record not found.");let t=o.clone(e.visitors),i=[];if((t=t.reverse()).map((e,r)=>{e.createdBy&&i.indexOf(e.createdBy.toString())<0&&i.push(e.createdBy)}),!(i&&i.length>0))return d.success(r,t);s.getNames(i).then(i=>(i&&i.length>0&&t.forEach(r=>{r._homeId=e.number;let t=i.filter(e=>e._id.toString()==r.createdBy);t&&t.length>0&&t[0]._id&&(r.createdBy=t[0].name)}),d.success(r,t))).catch(e=>d.success(r,t))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findOne({"visitors._id":e.params.id},{visitors:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.visitors?(t=t.visitors.filter((r,t)=>r._id==e.params.id),d.success(r,t&&t.length>0?t[0]:null)):d.cError(r,"Record not found.")).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>d.cError(r,"Not implemented."),r.delete=(e,r)=>{i.update({"visitors._id":e.params.id},{$pull:{visitors:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?d.cError(r,"Could not delete record with id "+e.params.id):d.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.exit=(e,r)=>{let t=e.headers["user-id"]||"";i.findOneAndUpdate({"visitors._id":e.params.id},{$set:{"visitors.$.isActive":!1,"visitors.$.updatedBy":t||null}},{projection:{_id:1}}).then(t=>t&&t._id?d.success(r,!0,"Visitor exit success."):d.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Error updating record with id "+e.params.id))},r.search=(e,r)=>d.cError(r,"Not implemented.");const c=(e,r,t,i,d,o,c,l)=>{s.getMailANDFCMs(l).then(s=>{let l="<html><body>";l+='<div style="width: 100%; margin: 15px;">',l+='<div style="width: 100%; font-weight: bold; margin: 10px 0px;">Visitor arrived to your Home '+e+"</div>",l+='<div style="width: 100%;">',r&&r.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Name: '+r+"</div>",pushBody+=r),t>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Age: '+t+"</div>",pushBody+=(pushBody.length>0?", ":"")+t),i&&i.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Gender: '+("M"==i?"Male":"F"==i?"Female":"")+"</div>",pushBody+=(pushBody.Length>0?", ":"")+("M"==data.Gender?"Male":"F"==data.Gender?"Female":"")),d&&d.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Mobile Number: '+d+"</div>",pushBody+=(pushBody.Length>0?", ":"")+d),o&&o.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Email Id: '+o+"</div>",pushBody+=(pushBody.Length>0?", ":"")+o),c&&c.length>0&&(l+='<div style="width: 100%; margin: 5px 0px;">Image: </div>',l+='<div style="width: 100%; margin: 5px 0px;"><img src="'+c+'" alt="Visitor" height="250" width="250" /></div>'),l+="</div></body></html>",n.send("Visitor arrived to your Home "+e,l,s.mailIds,!0),a.send("Visitor arrived to your Home "+e,pushBody,s.fcmTokens)}).catch(e=>{})}},function(e,r,t){"use strict";const i=t(1),d=t(57);e.exports=e=>{e.post("/home/:id",i.checkToken,d.create),e.get("/homes/:id",i.checkToken,d.findAll),e.get("/home/:id",i.checkToken,d.findOne),e.put("/home/:id",i.checkToken,d.update),e.delete("/home/:id",i.checkToken,d.delete),e.get("/home/search/:text",i.checkToken,d.search),e.get("/home/checkno/:num",i.checkToken,d.checkNum)}},function(e,r,t){"use strict";const i=t(2),d=t(0);r.create=(e,r)=>{if(!e.body._blockId||!e.body.number)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["client-id"]||"",o=e.headers["user-id"]||"";i.findOne({number:e.body.number,isActive:!0},{_id:1}).then(n=>{if(n&&n._id)return d.cError(r,"Home with same number already exists. So please try with different number.");new i({_clientId:t,_blockId:e.body._blockId,number:e.body.number||"",address:e.body.address||"",bedRoom:e.body.bedRoom||0,parking:e.body.parking||"",description:e.body.description||"",members:e.body.memberIds||[],vehicles:[],servents:[],tickets:[],visitors:[],payments:[],outings:[],documents:[],isActive:!0,createdBy:o||null}).save().then(e=>e&&e._id?d.success(r,e._id):d.cError(r,"Failed to create home.")).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving records."))},r.findAll=(e,r)=>{let t=e.headers["client-id"]||"";if(!t||t.length<1)return d.vError(r,"Validation failed. Please send client id.");i.find({_clientId:e.params.id,isActive:!0},{_id:1,_blockId:1,number:1,members:1}).then(e=>d.success(r,e)).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findById(e.params.id).then(t=>t?d.success(r,t):d.cError(r,"Record not found with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Error retrieving record with id "+e.params.id))},r.update=(e,r)=>{if(!e.body._blockId||!e.body.number)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOne({number:e.body.number,isActive:!0},{_id:1}).then(o=>{if(o&&o._id&&o._id!=e.params.id)return d.cError(r,"Home with same number already exists. So please try with different number.");i.findByIdAndUpdate(e.params.id,{_blockId:e.body._blockId,number:e.body.number||"",address:e.body.address||"",bedRoom:e.body.bedRoom||0,parking:e.body.parking||"",description:e.body.description||"",members:e.body.memberIds||[],updatedBy:t},{new:!0}).then(t=>t&&t._id?d.success(r,t._id):d.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Error updating record with id "+e.params.id))}).catch(e=>d.error(r,e.message||"Some error occurred while retrieving records."))},r.delete=(e,r)=>{let t=e.headers["user-id"]||"";i.findByIdAndUpdate(e.params.id,{isActive:!1,updatedBy:t||null}).then(t=>t&&t._id?d.success(r,!0,"Record deleted successfully."):d.cError(r,"Could not delete record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>{i.find({$and:[{$or:[{number:new RegExp(e.params.text,"i")}],isActive:!0}]}).then(e=>d.success(r,e)).catch(e=>d.error(r,e.message||"Some error occurred while retrieving records."))},r.checkNum=(e,r)=>{i.find({number:e.params.num},{_id:1}).then(e=>!e||!e.length>0?d.success(r,!1):d.success(r,!0)).catch(e=>d.error(r,e.message||"Some error occurred while retrieving records."))}},function(e,r,t){"use strict";const i=t(1),d=t(59);e.exports=e=>{e.post("/block/:id",i.checkToken,d.create),e.get("/blocks/:id",i.checkToken,d.findAll),e.get("/block/:id",i.checkToken,d.findOne),e.put("/block/:id",i.checkToken,d.update),e.delete("/block/:id",i.checkToken,d.delete),e.get("/block/search/:text",i.checkToken,d.search)}},function(e,r,t){"use strict";const i=t(6),d=t(0);r.create=(e,r)=>{if(!e.body.name)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOne({"blocks.name":e.params.name},{blocks:[{$elemMatch:{isActive:!0}}]}).then(o=>{if(o&&o.blocks&&!(o.blocks.length<1))return d.cError(r,"Block with same name already exists. So please try with different name.");i.updateOne({_id:e.params.id},{$push:{blocks:{name:e.body.name||"",description:e.body.description||"",isActive:!0,createdBy:t}}},{new:!0}).then(t=>{if(!t||!t.ok||t.ok<1)return d.cError(r,"Failed to create record.");i.findById(e.params.id,{blocks:[{$elemMatch:{isActive:!0}}]}).then(e=>!e||!e.blocks||e.blocks.length<1?d.cError(r,"Failed to create record."):d.success(r,e.blocks[e.blocks.length-1]._id)).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))}).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))},r.findAll=(e,r)=>{i.findById(e.params.id,{blocks:[{$elemMatch:{isActive:!0}}]}).then(e=>e&&e.blocks?d.success(r,e.blocks):d.cError(r,"Record not found.")).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.findOne=(e,r)=>{i.findOne({"blocks._id":e.params.id},{blocks:[{$elemMatch:{isActive:!0}}]}).then(t=>t&&t.blocks?(t=t.blocks.filter((r,t)=>r._id==e.params.id),d.success(r,t&&t.length>0?t[0]:null)):d.cError(r,"Record not found.")).catch(e=>d.error(r,e.message||"Some error occurred while retrieving data."))},r.update=(e,r)=>{if(!e.body.name)return d.vError(r,"Validation failed. Please fill all the required fields.");let t=e.headers["user-id"]||"";i.findOne({"blocks.name":e.params.name},{blocks:[{$elemMatch:{isActive:!0}}]}).then(o=>{(!o||!o.blocks||o.blocks.length<1||o.blocks[0]._id==e.params.id)&&i.findOneAndUpdate({"blocks._id":e.params.id},{$set:{"blocks.$.name":e.body.name||"","blocks.$.description":e.body.description||"","blocks.$.updatedBy":t||null}},{projection:{_id:1}}).then(t=>t&&t._id?d.success(r,e.params.id):d.cError(r,"Error updating record with id "+e.params.id)).catch(t=>"ObjectId"===t.kind?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Error updating record with id "+e.params.id))}).catch(e=>d.error(r,e.message||"Some error occurred while creating a record."))},r.delete=(e,r)=>{i.update({"blocks._id":e.params.id},{$pull:{blocks:{_id:e.params.id}}},{safe:!0,multi:!0,new:!0}).then(t=>!t||!t.ok||t.ok<1?d.cError(r,"Could not delete record with id "+e.params.id):d.success(r,!0,"Record deleted successfully.")).catch(t=>"ObjectId"===t.kind||"NotFound"===t.name?d.nError(r,"Record not found with id "+e.params.id):d.error(r,"Internal server error. Could not delete record with id "+e.params.id))},r.search=(e,r)=>d.cError(r,"Not implemented.")},function(e,r,t){"use strict";const i=t(1);var d=t(61);const o=d.diskStorage({destination(e,r,t){t(null,"./assets/file")},filename(e,r,t){t(null,`${r.originalname}`)}}),n=d({storage:o});e.exports=e=>{e.post("/upload",i.checkToken,n.single("file"),(e,r,t)=>r.send({data:!0,message:""}))}},function(e,r){e.exports=require("multer")}]);